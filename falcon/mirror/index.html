
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="ZJUSCT Documents &amp; Blogs" name="description"/>
<meta content="ZJUSCT" name="author"/>
<link href="https://docs.zjusct.io/falcon/mirror/" rel="canonical"/>
<link href="../mirror-history/" rel="prev"/>
<link href="../../optimization/" rel="next"/>
<link href="../../assets/zjusct.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.14" name="generator"/>
<title>ZJU Mirror 镜像站 - ZJUSCT 文档与博客</title>
<link href="../../assets/stylesheets/main.342714a4.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../stylesheets/fonts.css" rel="stylesheet"/>
<link href="../../stylesheets/counter.css" rel="stylesheet"/>
<link href="../../stylesheets/theme.css" rel="stylesheet"/>
<link href="../../stylesheets/neoteroi-v1.1.2.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></link></head>
<body data-md-color-accent="indigo" data-md-color-primary="pink" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#zju-mirror-镜像站">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="ZJUSCT 文档与博客" class="md-header__button md-logo" data-md-component="logo" href="../.." title="ZJUSCT 文档与博客">
<img alt="logo" src="../../assets/zjusct.svg"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            ZJUSCT 文档与博客
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              ZJU Mirror 镜像站
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="切换至浅色模式" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme)" data-md-color-primary="pink" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="切换至浅色模式">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"></path></svg>
</label>
<input aria-label="切换至深色模式" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="indigo" data-md-color-scheme="zjusct" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="切换至深色模式">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="根据系统模式切换主题" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="根据系统模式切换主题">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/ZJUSCT/docs.zjusct.io" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    docs.zjusct.io
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
          
  
  
    
  
  首页

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../competition/">
          
  
  
    
  
  🏆 竞赛

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../">
          
  
  
    
  
  🦅 Falcon

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../optimization/">
          
  
  
    
  
  🔧 优化

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../operation/">
          
  
  
    
  
  ⚙️ 运维

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../blog/">
          
  
  
    
  
  ✍️ 博客

        </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="ZJUSCT 文档与博客" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="ZJUSCT 文档与博客">
<img alt="logo" src="../../assets/zjusct.svg"/>
</a>
    ZJUSCT 文档与博客
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/ZJUSCT/docs.zjusct.io" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    docs.zjusct.io
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_1" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    首页
    
  </span>
</a>
<label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_1_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
            首页
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../index/contribute/">
<span class="md-ellipsis">
    贡献
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../index/history/">
<span class="md-ellipsis">
    ZJUSCT 历史
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../index/newcomer/">
<span class="md-ellipsis">
    ZJUSCT 集群新手指南
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../competition/">
<span class="md-ellipsis">
    🏆 竞赛
    
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            🏆 竞赛
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    🦅 Falcon
    
  </span>
</a>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            🦅 Falcon
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../git/">
<span class="md-ellipsis">
    ZJU Git 代码托管服务
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../mirror-history/">
<span class="md-ellipsis">
    ZJU Mirror 历史
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    ZJU Mirror 镜像站
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    ZJU Mirror 镜像站
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#简介">
<span class="md-ellipsis">
      简介
    </span>
</a>
<nav aria-label="简介" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#丰富的镜像">
<span class="md-ellipsis">
      丰富的镜像
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#标准化">
<span class="md-ellipsis">
      标准化
    </span>
</a>
<nav aria-label="标准化" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#镜像获得官方认证">
<span class="md-ellipsis">
      镜像获得官方认证
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#接入校园网联合镜像站">
<span class="md-ellipsis">
      接入校园网联合镜像站
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#透明">
<span class="md-ellipsis">
      透明
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#faq">
<span class="md-ellipsis">
      FAQ
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#基础知识">
<span class="md-ellipsis">
      基础知识
    </span>
</a>
<nav aria-label="基础知识" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#构成">
<span class="md-ellipsis">
      构成
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#服务方式">
<span class="md-ellipsis">
      服务方式
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#同步方式">
<span class="md-ellipsis">
      同步方式
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#观测">
<span class="md-ellipsis">
      观测
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#基础设施">
<span class="md-ellipsis">
      基础设施
    </span>
</a>
<nav aria-label="基础设施" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#存储服务器-h3c-x10536-g3">
<span class="md-ellipsis">
      存储服务器 H3C X10536 G3
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#业务服务器-h3c-r4900-g3">
<span class="md-ellipsis">
      业务服务器 H3C R4900 G3
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#交换机-h3c-s6520x-24st-si">
<span class="md-ellipsis">
      交换机 H3C S6520X-24ST-SI
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#定位损坏的磁盘">
<span class="md-ellipsis">
      定位损坏的磁盘
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#后端">
<span class="md-ellipsis">
      后端
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#前端">
<span class="md-ellipsis">
      前端
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#软件源和同步工具">
<span class="md-ellipsis">
      软件源和同步工具
    </span>
</a>
<nav aria-label="软件源和同步工具" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#rsync">
<span class="md-ellipsis">
      rsync
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#apt">
<span class="md-ellipsis">
      APT
    </span>
</a>
<nav aria-label="APT" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ftpsync">
<span class="md-ellipsis">
      ftpsync
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../optimization/">
<span class="md-ellipsis">
    🔧 优化
    
  </span>
</a>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            🔧 优化
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../optimization/parallel/">
<span class="md-ellipsis">
    parallel
    
  </span>
</a>
<label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_4_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
            parallel
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2_2" id="__nav_4_2_2_label" tabindex="0">
<span class="md-ellipsis">
    cpu
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_2_2_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_2_2">
<span class="md-nav__icon md-icon"></span>
            cpu
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../optimization/parallel/cpu/model/">
<span class="md-ellipsis">
    模型
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../optimization/parallel/cpu/mpi/">
<span class="md-ellipsis">
    MPI
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../optimization/parallel/cpu/openmp/">
<span class="md-ellipsis">
    OpenMP
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../optimization/parallel/cpu/others/">
<span class="md-ellipsis">
    其他
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_2_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2_3" id="__nav_4_2_3_label" tabindex="0">
<span class="md-ellipsis">
    gpu
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_2_3_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_2_3">
<span class="md-nav__icon md-icon"></span>
            gpu
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../optimization/parallel/gpu/cuda/">
<span class="md-ellipsis">
    CUDA
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../optimization/parallel/gpu/hip/">
<span class="md-ellipsis">
    HIP
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../optimization/parallel/gpu/model/">
<span class="md-ellipsis">
    模型
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../optimization/parallel/gpu/others/">
<span class="md-ellipsis">
    Others
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../operation/">
<span class="md-ellipsis">
    ⚙️ 运维
    
  </span>
</a>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            ⚙️ 运维
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../operation/hardware/">
<span class="md-ellipsis">
    hardware
    
  </span>
</a>
<label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_2">
<span class="md-nav__icon md-icon"></span>
            hardware
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/hardware/knowledge/">
<span class="md-ellipsis">
    硬件知识
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/hardware/oobm/">
<span class="md-ellipsis">
    带外管理
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../operation/observability/">
<span class="md-ellipsis">
    observability
    
  </span>
</a>
<label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_3">
<span class="md-nav__icon md-icon"></span>
            observability
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/observability/log/">
<span class="md-ellipsis">
    日志收集
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/observability/network/">
<span class="md-ellipsis">
    网络观测
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/observability/opentelemetry/">
<span class="md-ellipsis">
    数据采集：OpenTelemetry
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../operation/software/">
<span class="md-ellipsis">
    software
    
  </span>
</a>
<label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_4">
<span class="md-nav__icon md-icon"></span>
            software
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/software/build/">
<span class="md-ellipsis">
    编译/构建系统
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/software/conda/">
<span class="md-ellipsis">
    包管理器：Conda
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/software/lmod/">
<span class="md-ellipsis">
    环境管理：Lmod
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/software/modern-cli/">
<span class="md-ellipsis">
    现代化 CLI 工具
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/software/shell/">
<span class="md-ellipsis">
    环境变量与 Shell
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/software/spack/">
<span class="md-ellipsis">
    包管理器：Spack
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../operation/system/">
<span class="md-ellipsis">
    system
    
  </span>
</a>
<label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_5">
<span class="md-nav__icon md-icon"></span>
            system
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/system/macOS/">
<span class="md-ellipsis">
    macOS 运维
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5_5_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_5_3" id="__nav_5_5_3_label" tabindex="0">
<span class="md-ellipsis">
    basic
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_5_3_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_5_5_3">
<span class="md-nav__icon md-icon"></span>
            basic
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/system/basic/acl/">
<span class="md-ellipsis">
    文件权限
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/system/basic/boot/">
<span class="md-ellipsis">
    启动过程
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/system/basic/drivers/">
<span class="md-ellipsis">
    Linux 设备驱动
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/system/basic/filesystem/">
<span class="md-ellipsis">
    文件系统
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/system/basic/systemd/">
<span class="md-ellipsis">
    systemd
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5_5_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../operation/system/diskless/">
<span class="md-ellipsis">
    diskless
    
  </span>
</a>
<label class="md-nav__link" for="__nav_5_5_4" id="__nav_5_5_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_5_4_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_5_5_4">
<span class="md-nav__icon md-icon"></span>
            diskless
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/system/diskless/cicd/">
<span class="md-ellipsis">
    自动构建：Jenkins
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/system/diskless/distros/">
<span class="md-ellipsis">
    其他发行版
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/system/diskless/nfsroot/">
<span class="md-ellipsis">
    核心机制：NFS Root
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/system/diskless/pxe/">
<span class="md-ellipsis">
    引导方式：PXE
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5_5_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_5_5" id="__nav_5_5_5_label" tabindex="0">
<span class="md-ellipsis">
    service
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_5_5_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_5_5_5">
<span class="md-nav__icon md-icon"></span>
            service
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/system/service/auth/">
<span class="md-ellipsis">
    身份认证与授权：NSS、PAM 和 SSSD
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/system/service/containers/">
<span class="md-ellipsis">
    容器
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/system/service/jenkins/">
<span class="md-ellipsis">
    CI/CD 平台：Jenkins
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/system/service/ldap/">
<span class="md-ellipsis">
    目录服务：LDAP
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/system/service/nis/">
<span class="md-ellipsis">
    网络信息服务：NIS
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/system/service/pve/">
<span class="md-ellipsis">
    虚拟化平台：PVE
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../operation/system/service/slurm/">
<span class="md-ellipsis">
    任务调度：Slurm
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../blog/">
<span class="md-ellipsis">
    ✍️ 博客
    
  </span>
</a>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            ✍️ 博客
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
<span class="md-ellipsis">
    posts
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_2">
<span class="md-nav__icon md-icon"></span>
            posts
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/posts/.template/">
<span class="md-ellipsis">
    None
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_2_2" id="__nav_6_2_2_label" tabindex="0">
<span class="md-ellipsis">
    2018
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_2_2_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_6_2_2">
<span class="md-nav__icon md-icon"></span>
            2018
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/2018/09/30/%E6%B5%99%E6%B1%9F%E5%A4%A7%E5%AD%A6%E8%B6%85%E7%AE%97%E9%98%9F%E5%8D%9A%E5%AE%A2%E6%B4%BB%E4%BA%86/">
<span class="md-ellipsis">
    浙江大学超算队博客...活了？
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/2018/11/25/cuda-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E6%80%BB%E7%BB%93-%E4%B8%80/">
<span class="md-ellipsis">
    CUDA 内存管理总结 (一)
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/2018/12/07/quick-guide-to-cuda-profiling/">
<span class="md-ellipsis">
    Quick Guide to CUDA Profiling
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/2018/12/23/distributed-tensorflow/">
<span class="md-ellipsis">
    Distributed Tensorflow
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/2018/12/24/bp-%E7%AE%97%E6%B3%95feed-forward-neural-network-and-back-propagation/">
<span class="md-ellipsis">
    （BP 算法）Feed forward neural network and back propagation
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6_2_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_2_3" id="__nav_6_2_3_label" tabindex="0">
<span class="md-ellipsis">
    2019
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_2_3_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_6_2_3">
<span class="md-nav__icon md-icon"></span>
            2019
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/2019/03/31/%E5%A6%82%E4%BD%95%E5%9C%A8%E5%A2%99%E5%86%85%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2-centos-7-%E7%9A%84-mysql/">
<span class="md-ellipsis">
    如何在墙内快速部署 CentOS 7 的 MySQL
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/2019/03/31/virtual-memory-and-tlb/">
<span class="md-ellipsis">
    Virtual Memory and TLB
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/2019/05/11/%E5%9F%BA%E4%BA%8E-0-1-%E4%B9%98%E6%80%A7%E5%99%AA%E5%A3%B0%E7%9A%84%E6%9C%B4%E7%B4%A0%E5%9B%BE%E7%89%87%E9%99%8D%E5%99%AA/">
<span class="md-ellipsis">
    基于 0-1 乘性噪声的朴素图片降噪
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/2019/05/27/20190526-%E4%BC%9A%E8%AE%AE%E8%AE%B0%E5%BD%95/">
<span class="md-ellipsis">
    2019.05.26 会议记录
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/2019/05/31/%E7%94%9F%E6%88%90%E5%BC%8F%E5%AF%B9%E6%8A%97%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/">
<span class="md-ellipsis">
    生成式对抗网络——基础
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/2019/06/14/%E7%94%9F%E6%88%90%E5%BC%8F%E5%AF%B9%E6%8A%97%E7%BD%91%E7%BB%9C%E7%90%86%E8%AE%BA/">
<span class="md-ellipsis">
    生成式对抗网络——理论
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/2019/06/16/%E5%9F%BA%E4%BA%8E-gan-%E7%9A%84%E5%8A%A8%E6%BC%AB%E5%A4%B4%E5%83%8F%E7%94%9F%E6%88%90/">
<span class="md-ellipsis">
    基于 GAN 的动漫头像生成
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/2019/06/21/rsa-%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E5%8F%8A%E5%85%B6%E6%95%B0%E5%AD%A6%E6%80%9D%E6%83%B3/">
<span class="md-ellipsis">
    RSA 加密算法及其数学思想
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6_2_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_2_4" id="__nav_6_2_4_label" tabindex="0">
<span class="md-ellipsis">
    2025
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_2_4_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_6_2_4">
<span class="md-nav__icon md-icon"></span>
            2025
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/2025/03/16/%E8%A0%95%E8%99%AB%E7%97%85%E6%AF%92%E5%85%A5%E4%BE%B5%E4%BA%8B%E4%BB%B6%E5%A7%8B%E6%9C%AB/">
<span class="md-ellipsis">
    蠕虫病毒入侵事件始末
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/2025/05/01/%E7%AC%AC%E4%B8%89%E4%BB%A3%E9%95%9C%E5%83%8F%E7%AB%99%E5%BB%BA%E8%AE%BE%E4%B8%80%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2/">
<span class="md-ellipsis">
    第三代镜像站建设（一）：服务器自动化部署
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/2025/05/19/-hello-hpc-world--2025-%E8%B6%85%E7%AE%97%E7%9F%AD%E5%AD%A6%E6%9C%9F%E8%AF%BE%E7%A8%8B%E6%AD%A3%E5%BC%8F%E5%90%AF%E5%8A%A8/">
<span class="md-ellipsis">
    🎓 Hello, HPC World | 2025 超算短学期课程正式启动！
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
<span class="md-ellipsis">
    Archive
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_3">
<span class="md-nav__icon md-icon"></span>
            Archive
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/archive/2025/">
<span class="md-ellipsis">
    2025
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/archive/2019/">
<span class="md-ellipsis">
    2019
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/archive/2018/">
<span class="md-ellipsis">
    2018
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
<span class="md-ellipsis">
    Categories
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_4">
<span class="md-nav__icon md-icon"></span>
            Categories
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/category/ai/">
<span class="md-ellipsis">
    AI
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/category/cuda/">
<span class="md-ellipsis">
    CUDA
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/category/centos/">
<span class="md-ellipsis">
    CentOS
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/category/ml/">
<span class="md-ellipsis">
    ML
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/category/meetingreport/">
<span class="md-ellipsis">
    MeetingReport
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/category/mysql/">
<span class="md-ellipsis">
    MySQL
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/category/operating-susyem/">
<span class="md-ellipsis">
    Operating Susyem
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/category/profile/">
<span class="md-ellipsis">
    Profile
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/category/spc/">
<span class="md-ellipsis">
    Spc
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/category/tlb/">
<span class="md-ellipsis">
    TLB
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/category/tech/">
<span class="md-ellipsis">
    Tech
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/category/tensorflow/">
<span class="md-ellipsis">
    Tensorflow
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/category/virtual-memory/">
<span class="md-ellipsis">
    Virtual Memory
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/category/zju/">
<span class="md-ellipsis">
    ZJU
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/category/zjusct/">
<span class="md-ellipsis">
    ZJUSCT
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/category/%E5%AF%86%E7%A0%81%E5%AD%A6/">
<span class="md-ellipsis">
    密码学
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/category/%E6%95%B0%E8%AE%BA/">
<span class="md-ellipsis">
    数论
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/category/%E7%9F%AD%E5%AD%A6%E6%9C%9F%E8%AF%BE%E7%A8%8B/">
<span class="md-ellipsis">
    短学期课程
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../blog/category/%E8%BF%90%E7%BB%B4/">
<span class="md-ellipsis">
    运维
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#简介">
<span class="md-ellipsis">
      简介
    </span>
</a>
<nav aria-label="简介" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#丰富的镜像">
<span class="md-ellipsis">
      丰富的镜像
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#标准化">
<span class="md-ellipsis">
      标准化
    </span>
</a>
<nav aria-label="标准化" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#镜像获得官方认证">
<span class="md-ellipsis">
      镜像获得官方认证
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#接入校园网联合镜像站">
<span class="md-ellipsis">
      接入校园网联合镜像站
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#透明">
<span class="md-ellipsis">
      透明
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#faq">
<span class="md-ellipsis">
      FAQ
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#基础知识">
<span class="md-ellipsis">
      基础知识
    </span>
</a>
<nav aria-label="基础知识" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#构成">
<span class="md-ellipsis">
      构成
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#服务方式">
<span class="md-ellipsis">
      服务方式
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#同步方式">
<span class="md-ellipsis">
      同步方式
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#观测">
<span class="md-ellipsis">
      观测
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#基础设施">
<span class="md-ellipsis">
      基础设施
    </span>
</a>
<nav aria-label="基础设施" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#存储服务器-h3c-x10536-g3">
<span class="md-ellipsis">
      存储服务器 H3C X10536 G3
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#业务服务器-h3c-r4900-g3">
<span class="md-ellipsis">
      业务服务器 H3C R4900 G3
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#交换机-h3c-s6520x-24st-si">
<span class="md-ellipsis">
      交换机 H3C S6520X-24ST-SI
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#定位损坏的磁盘">
<span class="md-ellipsis">
      定位损坏的磁盘
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#后端">
<span class="md-ellipsis">
      后端
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#前端">
<span class="md-ellipsis">
      前端
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#软件源和同步工具">
<span class="md-ellipsis">
      软件源和同步工具
    </span>
</a>
<nav aria-label="软件源和同步工具" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#rsync">
<span class="md-ellipsis">
      rsync
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#apt">
<span class="md-ellipsis">
      APT
    </span>
</a>
<nav aria-label="APT" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ftpsync">
<span class="md-ellipsis">
      ftpsync
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<nav class="md-tags">
<a class="md-tag" href="../../index/contribute/#tag:不完善">不完善</a>
</nav>
<a class="md-content__button md-icon" href="https://github.com/ZJUSCT/docs.zjusct.io/blob/main/docs/falcon/mirror.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"></path></svg>
</a>
<h1 id="zju-mirror-镜像站">ZJU Mirror 镜像站<a class="headerlink" href="#zju-mirror-镜像站" title="Permanent link">¶</a></h1>
<div class="admonition abstract">
<p class="admonition-title">Abstract</p>
<p>本文档是 ZJU Mirror 最新的信息记录和运维手册。关于 Mirror 的历史和已废弃的运维信息，见 <a href="../mirror-history/">ZJU Mirror 历史</a>。</p>
</div>
<h2 id="简介">简介<a class="headerlink" href="#简介" title="Permanent link">¶</a></h2>
<p>浙江大学开源软件镜像站 (<a href="https://mirrors.zju.edu.cn">https://mirrors.zju.edu.cn</a>) 是由 <a href="https://zuits.zju.edu.cn/">浙江大学信息中心</a> 支持、<a href="https://www.zjusct.io/">浙江大学超算队</a> 运营的，致力于普及开源软件、方便校内外用户高效访问开源项目的各种资源的非营利计划。本镜像站提供了包括 Docker、PostgreSQL、Ubuntu 等项目的镜像，以服务教育和科学研究为目的，提倡自由、平等、协作、共享的精神。</p>
<h3 id="丰富的镜像">丰富的镜像<a class="headerlink" href="#丰富的镜像" title="Permanent link">¶</a></h3>
<p>浙大镜像站拥有 50+ 个镜像，包括 Anaconda、Ubuntu、Pypi、ArchLinux、Debian、Homebrew 等常用镜像，满足了校内师生日常使用的需求。我们也为大部分镜像提供了帮助文档，帮助用户快速完成配置。</p>
<h3 id="标准化">标准化<a class="headerlink" href="#标准化" title="Permanent link">¶</a></h3>
<h4 id="镜像获得官方认证">镜像获得官方认证<a class="headerlink" href="#镜像获得官方认证" title="Permanent link">¶</a></h4>
<p>我们积极与上游联系，申请成为官方镜像。目前，已有 17 个镜像被认证为官方镜像，其中包括 Ubuntu、CentOS、ArchLinux、CTAN、ROS 等。成为官方镜像，证明我们服务的稳定性、实时性、正确性获得了官方的认可。</p>
<h4 id="接入校园网联合镜像站">接入<a href="https://mirrors.cernet.edu.cn/">校园网联合镜像站</a><a class="headerlink" href="#接入校园网联合镜像站" title="Permanent link">¶</a></h4>
<p>校园网联合镜像站是由中国教育和科研计算机网网络中心支持的项目，它提供对校园网镜像站的索引和跳转服务。我们对接了标准化的接口，向外界暴露我们实时的资源使用情况和镜像同步状态信息。</p>
<h3 id="透明">透明<a class="headerlink" href="#透明" title="Permanent link">¶</a></h3>
<p>如果用户对镜像同步的实时性有质疑，可以访问镜像站网页，查看同步状态信息。如果用户希望知道更多的细节，可以访问 <a href="https://mirrors.cernet.edu.cn/site/ZJU">浙大镜像站在校园网联合镜像站上的页面</a>，那里有更详细的同步状态信息。</p>
<h3 id="faq">FAQ<a class="headerlink" href="#faq" title="Permanent link">¶</a></h3>
<div class="admonition question">
<p class="admonition-title">浙大镜像站相比于 <a href="https://mirrors.tuna.tsinghua.com/">清华 TUNA 镜像站</a> 有什么优势？</p>
<ul>
<li>浙大内网环境</li>
</ul>
<p>我们的服务器位于校园内网。根据我们的了解，不少实验室的网络存在公网访问速度慢、甚至无法访问公网的问题。使用我们浙大自己的镜像服务，即使没有公网访问的权限，依然可以正常使用镜像。</p>
<ul>
<li>高优支持校内师生</li>
</ul>
<p>我们会始终把支持校内用户放在最高优先级。即使是一些小众的镜像，只要浙大校内存在对这一镜像的稳定需求，我们一定会跟进、支持。就在最近，一位校内同学提出了添加 ius 镜像的请求。这一镜像的用户量非常小，使用场景也局限在旧的发行版中。但了解到这位同学的实验室只能访问校园内网，而且在做科研的过程中确实对这一镜像有需求，我们就满足了这一请求。此外，镜像服务在校内的可用性也是我们最高优保障的。使用其他学校的镜像站，可能就不会享受这方面的优势。</p>
</div>
<h2 id="基础知识">基础知识<a class="headerlink" href="#基础知识" title="Permanent link">¶</a></h2>
<div class="admonition quote">
<p class="admonition-title">其他镜像站</p>
<p>这里提供其他镜像站的文档指引。即使具体架构不同，镜像站运维仍有很多经验可以相互参考，我们提倡开源共享的精神。</p>
<ul>
<li><a href="https://tuna.moe/event/2023/welcome-and-mirrors-infra/">金枪鱼之夜：2023 年秋季学期迎新会 &amp; TUNA 镜像站服务架构演进 | 清华大学 TUNA 协会</a></li>
<li><a href="https://docs.ustclug.org/services/mirrors/">开源镜像站 - LUG @ USTC</a></li>
<li><a href="https://github.com/sjtug/mirror-docker-unified/wiki">Home · sjtug/mirror-docker-unified Wiki</a></li>
</ul>
</div>
<p>文档的接下来的内容面向镜像站爱好者和运维人员，本节总体介绍镜像站的构成和运维方式。</p>
<h3 id="构成">构成<a class="headerlink" href="#构成" title="Permanent link">¶</a></h3>
<ul>
<li><strong>基础设施</strong>：镜像站的硬件设施和网络环境，决定了镜像站上层采用的技术栈和运维方式。学校间的差异很大，从单机部署到云平台都有。</li>
<li>
<p><strong>后端</strong>：负责镜像站的核心任务——同步和存储，它主要是一个同步任务调度器。规模较大的镜像站几乎都会定制自己的后端，下面是国内镜像站后端简表：</p>
<table>
<thead>
<tr>
<th>语言</th>
<th>后端实现</th>
</tr>
</thead>
<tbody>
<tr>
<td>Go</td>
<td><a href="https://github.com/tuna/tunasync">tuna/tunasync</a>、<a href="https://github.com/sjtug/lug">sjutg/lug</a>、<a href="https://github.com/ustclug/Yuki">ustclug/Yuki</a></td>
</tr>
<tr>
<td>Python</td>
<td><a href="https://github.com/PKUOSC/SyncController">PKUOSC</a></td>
</tr>
<tr>
<td>C#</td>
<td><a href="https://github.com/ZJUSCT/MirrorManager">ZJUSCT/MirrorManager</a></td>
</tr>
</tbody>
</table>
</li>
<li>
<p><strong>前端</strong>：负责镜像站的访问和用户交互。它主要是 Web 服务，提供了镜像列表、同步状态、帮助文档等功能。</p>
</li>
</ul>
<h3 id="服务方式">服务方式<a class="headerlink" href="#服务方式" title="Permanent link">¶</a></h3>
<p>绝大部分软件源使用 HTTP 提供服务，例如 Ubuntu、Debian、ArchLinux、CTAN、ROS 等。</p>
<p>下表是一些例外：</p>
<table>
<thead>
<tr>
<th>服务方式</th>
<th>举例</th>
</tr>
</thead>
<tbody>
<tr>
<td>Git</td>
<td>Homebrew、Linux 和 glibc 源码等</td>
</tr>
<tr>
<td>FTP</td>
<td>远古时期的服务方式，APT、AUR 等都曾经使用过</td>
</tr>
<tr>
<td>S3</td>
<td>暂无</td>
</tr>
</tbody>
</table>
<p>一些 HTTP 镜像并不是全量镜像，而是通过 HTTP 代理缓存提供服务，例如 PyPI、Anaconda 等。</p>
<h3 id="同步方式">同步方式<a class="headerlink" href="#同步方式" title="Permanent link">¶</a></h3>
<ul>
<li>绝大部分软件源使用 rsync 同步。</li>
<li>Git 源使用 <code>git remote update</code> 同步。</li>
</ul>
<p>TUNA 收录了国内最多的软件源，可以在 <a href="https://mirrors.tuna.tsinghua.edu.cn/status/">TUNA 状态页</a> 看到最为全面的镜像同步方式。</p>
<h3 id="观测">观测<a class="headerlink" href="#观测" title="Permanent link">¶</a></h3>
<p>部分软件源为镜像网络提供了一致的观测方式，能够帮助用户和管理员了解镜像的同步状态。以 Debian 为例，所有镜像站都具有 <code>debian/project/trace</code> 文件，在 <a href="https://mirror-master.debian.org/status/mirror-status.html">Debian Mirror Monitoring</a> 中汇总了所有镜像站的状态。</p>
<p><a href="https://mirrors.cernet.edu.cn/">MirrorZ</a> 是中国教育和科研计算机网网络中心支持的国内校园网镜像站索引和跳转服务。各大镜像站通过 MirrorZ 定义的<a href="https://github.com/mirrorz-org/mirrorz">标准化数据格式</a>，向外界暴露实时的资源使用情况和镜像同步状态信息。</p>
<h2 id="基础设施">基础设施<a class="headerlink" href="#基础设施" title="Permanent link">¶</a></h2>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<ul>
<li><a href="https://www.h3c.com/en/Support/Resource_Center/EN/Severs/Catalog/Optional_Parts/Network_Adapter/Technical_Documents/Product_Literature/Card_Datasheets/Network_Adapter_Datasheet/202206/1616867_294551_0.htm">Support - 02-PCIe network adapter specifications- H3C</a>：新华三网卡数据表。</li>
<li><a href="https://www.h3c.com/en/Support/Resource_Center/EN/Home/Severs/00-Public/Software_Configure/User_Manual/H3C_Servers_Storage_Controller_UG/202207/1655190_294551_0.htm">Support - 08-Configuring an H460, P460, P240 or P4408 storage controller- H3C</a>：RAID 卡配置手册。</li>
</ul>
</div>
<p>浙江大学镜像站所有的硬件资源都是由浙大信息中心赞助的。镜像站属于信息中心 <a href="https://soft.zju.edu.cn/">研在浙大·科研软件平台</a> 的一个子项目。</p>
<p>2025 年 4 月 17 日，我们从信息技术中心收到了新一代镜像站的硬件设施。新一代镜像站由 3 台存储服务器、2 台业务服务器构成，通过万兆交换机互联。</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../mirror.assets/infra.drawio"><div class="mxgraph" data-mxgraph='{"toolbar": "zoom", "tooltips": "1", "border": 5, "resize": "1", "edit": "_blank", "xml": "&lt;mxfile host=\"app.diagrams.net\" agent=\"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0\" version=\"26.2.13\"&gt;\n  &lt;diagram name=\"Page-1\" id=\"PLZw5Didg9Woypdv-pCe\"&gt;\n    &lt;mxGraphModel dx=\"643\" dy=\"1403\" grid=\"1\" gridSize=\"10\" guides=\"1\" tooltips=\"1\" connect=\"1\" arrows=\"1\" fold=\"1\" page=\"1\" pageScale=\"1\" pageWidth=\"827\" pageHeight=\"1169\" math=\"0\" shadow=\"0\"&gt;\n      &lt;root&gt;\n        &lt;mxCell id=\"0\"/&gt;\n        &lt;mxCell id=\"1\" parent=\"0\"/&gt;\n        &lt;mxCell id=\"_veUoHLHs1xzvvqsWgao-1\" value=\"\u4e07\u5146\u4ea4\u6362\u673a&amp;lt;div&amp;gt;H3C S6520X-24ST-SI&amp;lt;/div&amp;gt;\" style=\"rounded=0;whiteSpace=wrap;html=1;autosize=1;\" vertex=\"1\" parent=\"1\"&gt;\n          &lt;mxGeometry x=\"185\" y=\"360\" width=\"140\" height=\"40\" as=\"geometry\"/&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\"_veUoHLHs1xzvvqsWgao-2\" value=\"\u5b58\u50a8\u8282\u70b9&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;H3C X10536 G3&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;30 x 8TB HDD&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;6 x 480GB SSD&amp;lt;/div&amp;gt;\" style=\"rounded=0;whiteSpace=wrap;html=1;autosize=1;\" vertex=\"1\" parent=\"1\"&gt;\n          &lt;mxGeometry x=\"20\" y=\"450\" width=\"110\" height=\"70\" as=\"geometry\"/&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\"_veUoHLHs1xzvvqsWgao-3\" value=\"\u4e1a\u52a1\u8282\u70b9&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;H3C R4900G3&amp;lt;/div&amp;gt;\" style=\"rounded=0;whiteSpace=wrap;html=1;autosize=1;\" vertex=\"1\" parent=\"1\"&gt;\n          &lt;mxGeometry x=\"310\" y=\"270\" width=\"100\" height=\"40\" as=\"geometry\"/&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\"_veUoHLHs1xzvvqsWgao-4\" value=\"\u5b58\u50a8\u8282\u70b9&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;H3C X10536 G3&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;30 x 8TB HDD&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;6 x 480GB SSD&amp;lt;/div&amp;gt;\" style=\"rounded=0;whiteSpace=wrap;html=1;autosize=1;\" vertex=\"1\" parent=\"1\"&gt;\n          &lt;mxGeometry x=\"380\" y=\"450\" width=\"110\" height=\"70\" as=\"geometry\"/&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\"_veUoHLHs1xzvvqsWgao-5\" value=\"\u5b58\u50a8\u8282\u70b9&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;H3C X10536 G3&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;30 x 8TB HDD&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;6 x 480GB SSD&amp;lt;/div&amp;gt;\" style=\"rounded=0;whiteSpace=wrap;html=1;autosize=1;\" vertex=\"1\" parent=\"1\"&gt;\n          &lt;mxGeometry x=\"200\" y=\"450\" width=\"110\" height=\"70\" as=\"geometry\"/&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\"_veUoHLHs1xzvvqsWgao-6\" value=\"\u4e1a\u52a1\u8282\u70b9&amp;lt;br&amp;gt;&amp;lt;div&amp;gt;H3C R4900G3&amp;lt;/div&amp;gt;\" style=\"rounded=0;whiteSpace=wrap;html=1;autosize=1;\" vertex=\"1\" parent=\"1\"&gt;\n          &lt;mxGeometry x=\"100\" y=\"270\" width=\"100\" height=\"40\" as=\"geometry\"/&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\"_veUoHLHs1xzvvqsWgao-9\" value=\"2 x 10G SFP\" style=\"endArrow=classic;startArrow=classic;html=1;rounded=0;\" edge=\"1\" parent=\"1\" source=\"_veUoHLHs1xzvvqsWgao-1\" target=\"_veUoHLHs1xzvvqsWgao-6\"&gt;\n          &lt;mxGeometry width=\"50\" height=\"50\" relative=\"1\" as=\"geometry\"&gt;\n            &lt;mxPoint x=\"50\" y=\"410\" as=\"sourcePoint\"/&gt;\n            &lt;mxPoint x=\"100\" y=\"360\" as=\"targetPoint\"/&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\"_veUoHLHs1xzvvqsWgao-10\" value=\"2 x 10G SFP\" style=\"endArrow=classic;startArrow=classic;html=1;rounded=0;\" edge=\"1\" parent=\"1\" source=\"_veUoHLHs1xzvvqsWgao-1\" target=\"_veUoHLHs1xzvvqsWgao-3\"&gt;\n          &lt;mxGeometry width=\"50\" height=\"50\" relative=\"1\" as=\"geometry\"&gt;\n            &lt;mxPoint x=\"388.66999999999996\" y=\"360\" as=\"sourcePoint\"/&gt;\n            &lt;mxPoint x=\"329.66999999999996\" y=\"310\" as=\"targetPoint\"/&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\"_veUoHLHs1xzvvqsWgao-11\" value=\"4 x 10G SFP\" style=\"endArrow=classic;startArrow=classic;html=1;rounded=0;\" edge=\"1\" parent=\"1\" source=\"_veUoHLHs1xzvvqsWgao-2\" target=\"_veUoHLHs1xzvvqsWgao-1\"&gt;\n          &lt;mxGeometry width=\"50\" height=\"50\" relative=\"1\" as=\"geometry\"&gt;\n            &lt;mxPoint x=\"160.32999999999998\" y=\"420\" as=\"sourcePoint\"/&gt;\n            &lt;mxPoint x=\"101.33\" y=\"370\" as=\"targetPoint\"/&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\"_veUoHLHs1xzvvqsWgao-12\" value=\"4 x 10G SFP\" style=\"endArrow=classic;startArrow=classic;html=1;rounded=0;\" edge=\"1\" parent=\"1\" source=\"_veUoHLHs1xzvvqsWgao-5\" target=\"_veUoHLHs1xzvvqsWgao-1\"&gt;\n          &lt;mxGeometry width=\"50\" height=\"50\" relative=\"1\" as=\"geometry\"&gt;\n            &lt;mxPoint x=\"219.29000000000002\" y=\"450\" as=\"sourcePoint\"/&gt;\n            &lt;mxPoint x=\"290.29\" y=\"400\" as=\"targetPoint\"/&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\"_veUoHLHs1xzvvqsWgao-13\" value=\"4 x 10G SFP\" style=\"endArrow=classic;startArrow=classic;html=1;rounded=0;\" edge=\"1\" parent=\"1\" source=\"_veUoHLHs1xzvvqsWgao-4\" target=\"_veUoHLHs1xzvvqsWgao-1\"&gt;\n          &lt;mxGeometry width=\"50\" height=\"50\" relative=\"1\" as=\"geometry\"&gt;\n            &lt;mxPoint x=\"325\" y=\"460\" as=\"sourcePoint\"/&gt;\n            &lt;mxPoint x=\"325\" y=\"410\" as=\"targetPoint\"/&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\"_veUoHLHs1xzvvqsWgao-14\" value=\"10G SFP\" style=\"shape=flexArrow;endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;\" edge=\"1\" parent=\"1\" source=\"_veUoHLHs1xzvvqsWgao-1\" target=\"_veUoHLHs1xzvvqsWgao-15\"&gt;\n          &lt;mxGeometry width=\"50\" height=\"50\" relative=\"1\" as=\"geometry\"&gt;\n            &lt;mxPoint x=\"440\" y=\"380\" as=\"sourcePoint\"/&gt;\n            &lt;mxPoint x=\"450\" y=\"380\" as=\"targetPoint\"/&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\"_veUoHLHs1xzvvqsWgao-15\" value=\"\" style=\"ellipse;shape=cloud;whiteSpace=wrap;html=1;\" vertex=\"1\" parent=\"1\"&gt;\n          &lt;mxGeometry x=\"470\" y=\"340\" width=\"120\" height=\"80\" as=\"geometry\"/&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\"_veUoHLHs1xzvvqsWgao-16\" value=\"&amp;lt;h1 style=&amp;quot;margin-top: 0px;&amp;quot;&amp;gt;\u65b0\u955c\u50cf\u7ad9\u57fa\u7840\u8bbe\u65bd&amp;lt;/h1&amp;gt;&amp;lt;p&amp;gt;\u4f4d\u7f6e\uff1a\u6d59\u6c5f\u5927\u5b66\u7d2b\u91d1\u6e2f\u6821\u533a\u548c\u540c\u82d1 5 \u5e62\u5316\u56db 221 G6 \u673a\u67dc&amp;lt;/p&amp;gt;&amp;lt;p&amp;gt;\u4e0a\u6b21\u66f4\u65b0\uff1a2025 \u5e74 04 \u6708 19 \u65e5&amp;lt;/p&amp;gt;\" style=\"text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;align=center;\" vertex=\"1\" parent=\"1\"&gt;\n          &lt;mxGeometry x=\"85.61999999999999\" y=\"140\" width=\"338.75\" height=\"120\" as=\"geometry\"/&gt;\n        &lt;/mxCell&gt;\n      &lt;/root&gt;\n    &lt;/mxGraphModel&gt;\n  &lt;/diagram&gt;\n&lt;/mxfile&gt;"}' style="max-width:100%;border:1px solid transparent;"></div></a></p>
<div class="grid cards">
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../mirror.assets/infra-1.webp"><img alt="infra-1" src="../mirror.assets/infra-1.webp"/></a></p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="auto" href="../mirror.assets/infra-2.webp"><img alt="infra-2" src="../mirror.assets/infra-2.webp"/></a></p>
</div>
<h3 id="存储服务器-h3c-x10536-g3">存储服务器 <a href="https://www.h3c.com/cn/Service/Document_Software/Document_Center/Storage/Catalog/Massive_Scale_Out/H3C_UniStor_X10000_G3/">H3C X10536 G3</a><a class="headerlink" href="#存储服务器-h3c-x10536-g3" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>参数</th>
<th>值</th>
</tr>
</thead>
<tbody>
<tr>
<td>CPU</td>
<td>2 x Intel Xeon Silver 4110</td>
</tr>
<tr>
<td>内存</td>
<td>8 x 32GB DDR4 2666MHz RDIMM</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p>存储规格：每台配备 2 张 H3C P460 RAID 卡，具有 4GB 缓存和掉电保护。</p>
<p>其上连接的存储设备有：</p>
<table>
<thead>
<tr>
<th>数量</th>
<th>容量</th>
<th>类型</th>
<th>具体型号</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
<td>600G</td>
<td>12 Gbps SAS HDD 系统盘</td>
<td>SEAGATE ST600MM0009</td>
</tr>
<tr>
<td>6</td>
<td>480GB</td>
<td>12 Gbps SATA SSD 数据盘</td>
<td>Micron 5200 MTFD</td>
</tr>
<tr>
<td>30</td>
<td>8TB</td>
<td>12 Gbps SATA HDD 数据盘</td>
<td>SEAGATE ST8000NM0055-1RM</td>
</tr>
</tbody>
</table>
<p>系统盘已配置为 RAID1。</p>
</li>
<li>
<p>网络规格：每台配备 2 张双口 10G 以太网卡和 1 张双 1G 以太网卡。</p>
<table>
<thead>
<tr>
<th>插槽</th>
<th>网卡型号</th>
<th>规格</th>
<th>控制器</th>
</tr>
</thead>
<tbody>
<tr>
<td>板载</td>
<td>NIC-GE-2P-360T-B2-1-X</td>
<td>2 x 1GE RJ45</td>
<td>Intel NHI350AM</td>
</tr>
<tr>
<td>PCIe</td>
<td>CNA-10GE-2P-560F-B2-1</td>
<td>2 x 10GE SFP</td>
<td>Intel JL82599</td>
</tr>
<tr>
<td>FLOM</td>
<td>NIC-10GE-2P-560F-LOM</td>
<td>2 x 10GE SFP</td>
<td>Intel JL82599</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h3 id="业务服务器-h3c-r4900-g3">业务服务器 <a href="https://www.h3c.com/cn/Service/Document_Software/Document_Center/Server/Catalog/Rack_server/H3C_UniServer_R4900_G3/">H3C R4900 G3</a><a class="headerlink" href="#业务服务器-h3c-r4900-g3" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>参数</th>
<th>值</th>
</tr>
</thead>
<tbody>
<tr>
<td>CPU</td>
<td>2 x Intel Xeon Gold 6130</td>
</tr>
<tr>
<td>内存</td>
<td>6 x 16GB DDR4 2666MHz RDIMM</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p>存储规格：每台配备 1 张 H3C P460 RAID 卡，具有 4GB 缓存 和掉电保护。</p>
<p>其上连接的存储设备有：</p>
<table>
<thead>
<tr>
<th>数量</th>
<th>容量</th>
<th>类型</th>
<th>具体型号</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
<td>600G</td>
<td>12 Gbps SAS HDD 系统盘</td>
<td>SEAGATE ST600MM0009</td>
</tr>
</tbody>
</table>
<p>系统盘已配置为 RAID1。</p>
</li>
<li>
<p>网络规格：每台配备 1 张双口 10G 以太网卡。</p>
<table>
<thead>
<tr>
<th>插槽</th>
<th>网卡型号</th>
<th>规格</th>
<th>控制器</th>
</tr>
</thead>
<tbody>
<tr>
<td>PCIe</td>
<td>NIC-BCM957302-F-B-10Gb-2P</td>
<td>2 x 10GE SFP</td>
<td>Broadcom BCM57302</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h3 id="交换机-h3c-s6520x-24st-si">交换机 <a href="https://www.h3c.com/cn/Products_And_Solution/InterConnect/Products/Switches/Products/Park_Switches/Aggregation_Switch/S6500/S6520X-SI/">H3C S6520X-24ST-SI</a><a class="headerlink" href="#交换机-h3c-s6520x-24st-si" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>参数</th>
<th>值</th>
</tr>
</thead>
<tbody>
<tr>
<td>前面板业务端口描述</td>
<td>24 个 1/2.5/10GE SFP Plus 端口（2 个 Combo 1G/2.5G/5G/10G Base-T 自适应以太网端口）</td>
</tr>
<tr>
<td>交换容量</td>
<td>2.56Tbps/25.6Tbps</td>
</tr>
<tr>
<td>包转发率</td>
<td>360Mpps</td>
</tr>
<tr>
<td>链路聚合</td>
<td>支持 10GE 端口聚合</td>
</tr>
</tbody>
</table>
<h3 id="定位损坏的磁盘">定位损坏的磁盘<a class="headerlink" href="#定位损坏的磁盘" title="Permanent link">¶</a></h3>
<p>镜像站磁盘损坏应当联系信息中心进行更换。我们需要负责定位损坏的磁盘，将信息反馈给信息中心。</p>
<ul>
<li>如果是直通盘，则使用 <code>hwinfo --disk</code> 可以看到 Model 和 Serial Number，据此去 IPMI 的 Storage 选项卡搜索即可。</li>
<li>如果是逻辑卷：<ul>
<li>RAID 卡检测到坏盘后，会在 IPMI 中标记逻辑卷状态为 <code>Failed</code>，可直接定位。</li>
<li>
<p>RAID 卡尚未检测到磁盘损坏，而系统报错，则可以根据 SysFS 路径进行定位。以下面的路径为例：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a>// 内核日志，出现该日志的时候控制器已检测到磁盘损坏，会直接掉盘
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>tag#741 received 'logical unit failure' from controller for scsi 14:1:0:9
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a>// hwinfo 信息
</span><span id="__span-0-4"><a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a>SysFS BusID: 14:1:0:9
</span><span id="__span-0-5"><a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a>SysFS Device Link: /devices/pci0000:3a/0000:3a:00.0/0000:3b:00.0/host14/target14:1:0/14:1:0:9
</span></code></pre></div>
<p>将 BusID 的字段分为 0~3。</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>控制器编号</td>
</tr>
<tr>
<td>1</td>
<td>设备类型，逻辑卷为 <code>1</code>，直通盘为 <code>0</code></td>
</tr>
<tr>
<td>2</td>
<td>直通盘序号</td>
</tr>
<tr>
<td>3</td>
<td>逻辑卷序号</td>
</tr>
</tbody>
</table>
<p>比如上面的设备为逻辑卷 9，可以在 IPMI 中找到对应的逻辑卷。</p>
</li>
</ul>
</li>
</ul>
<h2 id="后端">后端<a class="headerlink" href="#后端" title="Permanent link">¶</a></h2>
<h2 id="前端">前端<a class="headerlink" href="#前端" title="Permanent link">¶</a></h2>
<h2 id="软件源和同步工具">软件源和同步工具<a class="headerlink" href="#软件源和同步工具" title="Permanent link">¶</a></h2>
<p>本节总结软件源的格式和布局、使用的同步工具、同步中的问题等内容，供镜像维护者参考。</p>
<h3 id="rsync">rsync<a class="headerlink" href="#rsync" title="Permanent link">¶</a></h3>
<p><code>rsync</code> 是镜像同步的核心工具。作为镜像站的维护者，了解 <code>rsync</code> 的<strong>工作原理、性能瓶颈和常用选项</strong>是非常重要的。建议阅读下面两篇文章：</p>
<ul>
<li><a href="https://rsync.samba.org/how-rsync-works.html">How Rsync Works</a>：Rsync 官方的介绍。</li>
<li><a href="https://michael.stapelberg.ch/posts/2022-07-02-rsync-how-does-it-work/">rsync, article 3: How does rsync work? (2022) - Michael Stapelberg</a>：介绍了 Rsync Protocol v27 的工作原理，特别是探究了同步过程中源/目的数据发生变化的情况。</li>
</ul>
<p>下面是从这些文章中总结出的要点：</p>
<ul>
<li>
<p><strong>两个角色</strong>：Receiver 和 Sender。至于 Client 和 Server，只要 Rsync 双方连接建立，就不再区分。</p>
<p>以 Rsync Pull 为例：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a>rsync<span class="w"> </span>rsync://HOST/SRC...<span class="w"> </span><span class="o">[</span>DEST<span class="o">]</span>
</span></code></pre></div>
<p>远程主机是 Sender，本机是 Receiver。</p>
<p>一旦建立连接，<strong>Sender 遍历自己的文件系统，将文件列表发送给 Receiver</strong>。</p>
<p><strong>Receiver 接收完文件列表后，fork 出 Generator</strong>，开始下面的流水线。</p>
</li>
<li>
<p><strong>流水线</strong>：Generator -&gt; Sender -&gt; Receiver</p>
<ul>
<li>
<p><strong>Generator</strong>：对比文件列表和本地文件树，执行删除、跳过、创建文件夹等操作。</p>
<p>遇到不能跳过（需要同步）的文件时，将文件分块，生成校验和，和文件索引一起发送给 Sender。</p>
<p>该本地文件将作为 Base file，Sender 接下来使用 Rsync 算法找到与之的差异。</p>
</li>
<li>
<p><strong>Sender</strong>：滚动校验和（Rolling Checksum）</p>
<p>Sender 采用类似<strong>滑动窗口</strong>的策略，逐字节扫描本地文件生成块校验和。如果某一块校验和匹配，说明该块不用同步，跳过该块并从该块的下一个字节开始继续扫描。</p>
<p>最终 Sender 将告诉 Receiver 从 Basefile 拷贝哪些文件块、如何重建文件、重建后文件的校验和。</p>
</li>
<li>
<p><strong>Receiver</strong>：</p>
<p>创建临时文件，从 Basefile 拷贝文件块，并从 Sender 接收文件块，重组文件。重组后对比校验和。</p>
<p>成功同步后，设置文件权限，重命名以替换原文件。</p>
</li>
</ul>
</li>
<li>
<p><strong>资源消耗</strong>：</p>
<ul>
<li>Sender 消耗 CPU 资源</li>
<li>Receiver 消耗 IO 资源</li>
</ul>
</li>
<li>
<p><strong>数据变化</strong>：<strong>文件列表</strong>传输完成后，<strong>文件</strong>开始传输前</p>
<ul>
<li>新增文件：忽略。</li>
<li>删除文件：退出，返回值 <code>24 Partial transfer due to vanished source files</code>。</li>
<li>文件内容变化：不影响，<strong>但会造成全局视角下的不一致，即此次 Rsync 后，部分文件为新版，部分文件为旧版</strong>。</li>
</ul>
<p>同步过程中应当避免文件变化。</p>
</li>
</ul>
<h3 id="apt">APT<a class="headerlink" href="#apt" title="Permanent link">¶</a></h3>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<ul>
<li><a href="https://wiki.debian.org/DebianRepository/Format">DebianRepositoryFormat - Debian Wiki</a>：Debian 软件仓库格式，详细地描述了其中的每种文件。</li>
<li><a href="https://www.debian.org/mirror/ftpmirror">Setting up a Debian archive mirror - Debian Wiki</a>：如何建立 Debian 镜像站。</li>
</ul>
</div>
<p><code>sources.list</code> 格式：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a>type uri distribution component1 component2 component3 [..] componentX
</span></code></pre></div>
<p>APT 首先从 <code>$URI/dists/$DISTRIBUTION</code> 下载 <code>InRelease</code> 或 <code>Release</code> 文件。前者文件内签名，后者需要使用 <code>Release.gpg</code> 验证。<strong><code>Release</code> 文件列出了该 <code>$DISTRIBUTION</code> 的索引文件及其哈希值</strong>：</p>
<div class="language-text highlight"><span class="filename">Release（部分）</span><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a>Suite: unstable
</span><span id="__span-3-2"><a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a>Codename: sid
</span><span id="__span-3-3"><a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a>Date: Thu, 26 Sep 2024 08:17:58 UTC
</span><span id="__span-3-4"><a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a>Valid-Until: Thu, 03 Oct 2024 08:17:58 UTC
</span><span id="__span-3-5"><a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a>Architectures: all amd64 arm64 armel armhf i386 mips64el ppc64el riscv64 s390x
</span><span id="__span-3-6"><a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a>Components: main contrib non-free-firmware non-free
</span><span id="__span-3-7"><a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a>MD5Sum:
</span><span id="__span-3-8"><a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a> 7f8beaf99c34820e69778ea792c2d338  5312136 contrib/Contents-all
</span><span id="__span-3-9"><a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a> e941316dc5a3e703335083e7b659b387    63339 contrib/Contents-all.diff/Index
</span></code></pre></div>
<p>接下来 APT 在 <code>$URI/dists/$DISTRIBUTION/$COMPONENT</code> 下载索引文件，比如 <code>binary-$ARCH/Packages.xz</code>、<code>source/Sources.xz</code>。<strong>索引文件列出了软件包的路径及其哈希值。</strong>例如，下面的 <code>Sources</code> 文件列出了 <code>0ad</code> 软件包的路径和哈希值：</p>
<div class="language-text highlight"><span class="filename">Sources（部分）</span><pre><span></span><code><span id="__span-4-1"><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a>Package: 0ad
</span><span id="__span-4-2"><a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a>Binary: 0ad
</span><span id="__span-4-3"><a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a>Architecture: amd64 arm64 armhf i386 kfreebsd-amd64 kfreebsd-i386
</span><span id="__span-4-4"><a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a>Files:
</span><span id="__span-4-5"><a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a> 4d5f452a06bcdba6907f3350219a63db 2565 0ad_0.0.26-3.dsc
</span><span id="__span-4-6"><a href="#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a>Checksums-Sha256:
</span><span id="__span-4-7"><a href="#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a> c2d4b91d9d20a27b4989495d3b370635e79e2f7a4ed1f9031abc89e9c1d50952 2565 0ad_0.0.26-3.dsc
</span><span id="__span-4-8"><a href="#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a>Package-List:
</span><span id="__span-4-9"><a href="#__codelineno-4-9" id="__codelineno-4-9" name="__codelineno-4-9"></a> 0ad deb games optional arch=amd64,arm64,armhf,i386,kfreebsd-amd64,kfreebsd-i386
</span><span id="__span-4-10"><a href="#__codelineno-4-10" id="__codelineno-4-10" name="__codelineno-4-10"></a>Directory: pool/main/0/0ad
</span></code></pre></div>
<p><strong>软件包都保存在 <code>$URI/pool/$COMPONENT</code> 下</strong>，按照首字母分目录存放。一些常见的文件：</p>
<ul>
<li><code>.deb</code>：二进制包</li>
<li>
<p><code>.dsc</code>：源码包描述文件，指定哪些文件组成源码包。一般是 <code>.orig.tar</code>、<code>.debian.tar</code>。例如：</p>
<div class="language-text highlight"><span class="filename">0ad_0.0.23.1-5.dsc（部分）</span><pre><span></span><code><span id="__span-5-1"><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a>Checksums-Sha1:
</span><span id="__span-5-2"><a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a>3c6bb8924d65d17200e6b9475101e7d04f5db13a 31922812 0ad_0.0.23.1.orig.tar.xz
</span><span id="__span-5-3"><a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a>85ac24b7b826f4345dc5dd4015256ce1eb0cab70 73620 0ad_0.0.23.1-5.debian.tar.xz
</span><span id="__span-5-4"><a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a>Checksums-Sha256:
</span><span id="__span-5-5"><a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a>01bff7641ee08cac896c54d518d7e4b01752513105558f212e3199d747512a37 31922812 0ad_0.0.23.1.orig.tar.xz
</span><span id="__span-5-6"><a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a>aff899c0b6a0c2ff746e051504a3e3ac7bb6070c21eb5a5ef5fb55d55391b0e0 73620 0ad_0.0.23.1-5.debian.tar.xz
</span><span id="__span-5-7"><a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a>Files:
</span><span id="__span-5-8"><a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a>4fa111410ea55de7a013406ac1013668 31922812 0ad_0.0.23.1.orig.tar.xz
</span><span id="__span-5-9"><a href="#__codelineno-5-9" id="__codelineno-5-9" name="__codelineno-5-9"></a>43a5bf77192a8eebdbe763cdd1d72fa3 73620 0ad_0.0.23.1-5.debian.tar.xz
</span></code></pre></div>
</li>
</ul>
<details class="info">
<summary><code>pool</code> 的历史</summary>
<p>曾经，软件包按 DISTRIBUTION 存放在 <code>dists/</code> 下，造成了软件包的重复存储，每次发布新 DISTRIBUTION 需要传输大量文件。<code>pool</code> 目录的引入解决了这个问题，允许多个 DISTRIBUTION 共享软件包。</p>
</details>
<h4 id="ftpsync"><code>ftpsync</code><a class="headerlink" href="#ftpsync" title="Permanent link">¶</a></h4>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<ul>
<li><a href="https://salsa.debian.org/mirror-team/archvsync/">Debian Mirror team / archvsync · GitLab</a></li>
</ul>
</div>
<p>所有 Debian 镜像站都使用 <code>ftpsync</code> 进行同步，它执行两阶段同步：</p>
<ul>
<li>第一阶段<ul>
<li>忽略索引文件：<code>Packages*</code>, <code>Sources*</code>, <code>Release*</code>，<code>InRelease</code>。</li>
<li>不删除任何文件。</li>
</ul>
</li>
<li>第二阶段<ul>
<li>同步索引文件。</li>
<li>删除不在 mirror 中的文件。</li>
</ul>
</li>
</ul>
<p>也就是先同步再索引，防止索引到不存在的文件。</p>
<p><code>ftpsync</code> 支持从多个 archive 同步。Debian 网络中通用的 archive 有：</p>
<ul>
<li>standard debian archive: default empty $ARCHIVE (ftpsync.conf)</li>
<li>debian-ports archive:  ARCHIVE=ports (ftpsync-ports.conf)</li>
<li>debian-security archive: ARCHIVE=security (ftpsync-security.conf)</li>
</ul>
<p>有了上面的知识，我们就能理解 <code>ftpsync</code> 的命令行选项了：</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Behaviour</th>
</tr>
</thead>
<tbody>
<tr>
<td>stage1</td>
<td>Only do stage1 sync</td>
</tr>
<tr>
<td>stage2</td>
<td>Only do stage2 sync</td>
</tr>
<tr>
<td>all</td>
<td>Do a complete sync (default)</td>
</tr>
<tr>
<td>mhop</td>
<td>Do a multi-hop sync</td>
</tr>
<tr>
<td>archive:foo</td>
<td>Sync archive foo (if the file $HOME/etc/ftpsync-foo.conf exists and is configured)</td>
</tr>
<tr>
<td>callback</td>
<td>Call back when done (needs proper ssh setup for this to work). It will always use the "command" callback:$HOSTNAME where $HOSTNAME is the one defined in config and will happen before slave mirrors are triggered.</td>
</tr>
</tbody>
</table>
<p>接下来阅读 <code>ftpsync</code> 源码。</p>
<ul>
<li>解析命令行参数</li>
<li>
<p>读取配置文件</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-6-1"><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a>read_config<span class="o">()</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-6-2"><a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="nb">local</span><span class="w"> </span><span class="nv">name</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span>-e<span class="w"> </span><span class="s1">'s/[^A-Za-z0-9._-]/_/g'</span><span class="k">)</span>
</span><span id="__span-6-3"><a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="nb">local</span><span class="w"> </span><span class="nv">config</span><span class="o">=</span><span class="k">$(</span>search_config<span class="w"> </span><span class="s2">"</span><span class="nv">$name</span><span class="s2">"</span><span class="k">)</span>
</span><span id="__span-6-4"><a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">"</span><span class="nv">$config</span><span class="s2">"</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-6-5"><a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="w">    </span>.<span class="w"> </span><span class="s2">"</span><span class="nv">$config</span><span class="s2">"</span>
</span><span id="__span-6-6"><a href="#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="w">    </span><span class="nv">CURRENT_CONFIG</span><span class="o">=</span><span class="s2">"</span><span class="nv">$config</span><span class="s2">"</span>
</span><span id="__span-6-7"><a href="#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-6-8"><a href="#__codelineno-6-8" id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="k">else</span>
</span><span id="__span-6-9"><a href="#__codelineno-6-9" id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"Can't read config file </span><span class="si">${</span><span class="nv">name</span><span class="si">}</span><span class="s2">!"</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
</span><span id="__span-6-10"><a href="#__codelineno-6-10" id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">78</span><span class="w"> </span><span class="c1"># EX_CONFIG</span>
</span><span id="__span-6-11"><a href="#__codelineno-6-11" id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="k">fi</span>
</span><span id="__span-6-12"><a href="#__codelineno-6-12" id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="o">}</span>
</span></code></pre></div>
<p>配置文件大概长这样：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-7-1"><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="nv">MIRRORNAME</span><span class="o">=</span><span class="sb">`</span>hostname<span class="w"> </span>-f<span class="sb">`</span>
</span><span id="__span-7-2"><a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="nv">TO</span><span class="o">=</span><span class="s2">"/srv/mirrors/debian/"</span>
</span><span id="__span-7-3"><a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="nv">MAILTO</span><span class="o">=</span><span class="s2">"</span><span class="nv">$LOGNAME</span><span class="s2">"</span>
</span><span id="__span-7-4"><a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="nv">HUB</span><span class="o">=</span><span class="nb">false</span>
</span></code></pre></div>
<p>因此可以直接使用 <code>.</code> 读取配置文件。</p>
</li>
<li>
<p>设置 <code>rsync</code> 选项</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-8-1"><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="nv">RSYNC</span><span class="o">=</span><span class="si">${</span><span class="nv">RSYNC</span><span class="k">:-</span><span class="nv">rsync</span><span class="si">}</span>
</span><span id="__span-8-2"><a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="nv">RSYNC_PROTOCOL</span><span class="o">=</span><span class="k">$(</span>rsync_protocol<span class="k">)</span>
</span><span id="__span-8-3"><a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="nv">RSYNC_EXTRA</span><span class="o">=</span><span class="si">${</span><span class="nv">RSYNC_EXTRA</span><span class="k">:-</span><span class="s2">""</span><span class="si">}</span>
</span><span id="__span-8-4"><a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="nv">RSYNC_BW</span><span class="o">=</span><span class="si">${</span><span class="nv">RSYNC_BW</span><span class="k">:-</span><span class="nv">0</span><span class="si">}</span>
</span><span id="__span-8-5"><a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$RSYNC_PROTOCOL</span><span class="w"> </span>-ge<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-8-6"><a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="w">    </span><span class="nv">RSYNC_OPTIONS</span><span class="o">=</span><span class="si">${</span><span class="nv">RSYNC_OPTIONS</span><span class="k">:-</span><span class="s2">"-prltvHSB8192 --safe-links --chmod=D755,F644 --timeout 120 --stats --no-human-readable --no-inc-recursive"</span><span class="si">}</span>
</span><span id="__span-8-7"><a href="#__codelineno-8-7" id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="k">else</span>
</span><span id="__span-8-8"><a href="#__codelineno-8-8" id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="w">    </span><span class="nv">RSYNC_OPTIONS</span><span class="o">=</span><span class="si">${</span><span class="nv">RSYNC_OPTIONS</span><span class="k">:-</span><span class="s2">"-prltvHSB8192 --safe-links --timeout 120 --stats --no-human-readable --no-inc-recursive"</span><span class="si">}</span>
</span><span id="__span-8-9"><a href="#__codelineno-8-9" id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="k">fi</span>
</span><span id="__span-8-10"><a href="#__codelineno-8-10" id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="nv">RSYNC_OPTIONS1</span><span class="o">=</span><span class="si">${</span><span class="nv">RSYNC_OPTIONS1</span><span class="k">:-</span><span class="s2">"--include=*.diff/ --include=by-hash/ --exclude=*.diff/Index --exclude=Contents*--exclude=Packages* --exclude=Sources*--exclude=Release* --exclude=InRelease --exclude=i18n/*--exclude=dep11/* --exclude=installer-*/current --exclude=ls-lR*"</span><span class="si">}</span>
</span><span id="__span-8-11"><a href="#__codelineno-8-11" id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="nv">RSYNC_OPTIONS2</span><span class="o">=</span><span class="si">${</span><span class="nv">RSYNC_OPTIONS2</span><span class="k">:-</span><span class="s2">"--max-delete=40000 --delay-updates --delete --delete-delay --delete-excluded"</span><span class="si">}</span>
</span></code></pre></div>
<p><code>RSYNC_OPTIONS</code> 包含以下选项（参考 <a href="https://download.samba.org/pub/rsync/rsync.1">rsync(1)</a>）：</p>
<ul>
<li><code>-p</code>：保留文件权限。</li>
<li><code>-r</code>：递归复制目录。</li>
<li><code>-l</code>：保留符号链接。</li>
<li><code>-t</code>：保留文件修改时间。</li>
<li><code>-v</code>：显示详细信息（verbose）。</li>
<li><code>-H</code>：保留硬链接。</li>
<li>
<p><code>-S</code>：高效地复制稀疏文件。</p>
<blockquote>
<p>turn sequences of nulls into sparse blocks</p>
<p>Try to handle sparse files efficiently so they take up less space on the destination.</p>
</blockquote>
<p>了解过文件系统的同学或许会知道稀疏块的概念。</p>
</li>
<li>
<p><code>-B8192</code>：设置块大小为 8192 字节，用于增量传输。</p>
<blockquote>
<p>This forces the block size used in rsync's delta-transfer algorithm to a fixed value.</p>
</blockquote>
<p>在 rsync 传输文件时，它使用了 delta algorithm（增量算法）来尽可能只传输源文件和目标文件之间的差异，而不是整个文件。这个算法将文件划分为多个小块，并根据这些块的内容生成校验和，然后通过比较这些校验和，识别哪些块需要传输。</p>
</li>
<li>
<p><code>--safe-links</code>：忽略指向外部目录的符号链接，保证安全。</p>
</li>
<li><code>--chmod=D755,F644</code>：设置目录权限为 755，文件权限为 644。</li>
<li><code>--timeout=120</code>：超时时间为 120 秒。</li>
<li><code>--stats</code>：在传输完成后显示统计信息。</li>
<li><code>--no-human-readable</code>：在统计输出中不以人类可读的格式显示大小和速度。</li>
<li>
<p><code>--no-inc-recursive</code>：不使用增量递归算法，适合大数据传输时的稳定性。</p>
<blockquote>
<p>This makes rsync scan the full file list before it begins to transfer files. See <code>--inc-recursive</code> for more info.</p>
</blockquote>
</li>
</ul>
<p><code>RSYNC_OPTIONS2</code>：主要用于删除文件的相关选项：</p>
<ul>
<li><code>--max-delete=40000</code>：一次最多删除 40000 个文件，限制删除操作的数量。</li>
<li><code>--delay-updates</code>：在所有文件传输完成后再更新目标文件，减少临时不一致的时间。</li>
<li><code>--delete</code>：在目标目录中删除源目录中不存在的文件（与同步时保持一致）。</li>
<li><code>--delete-delay</code>：延迟文件删除操作，直到传输完成。</li>
<li><code>--delete-excluded</code>：删除那些被排除的文件。</li>
</ul>
</li>
<li>
<p>锁文件和同步标记</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-9-1"><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="c1"># Our trace and lock files</span>
</span><span id="__span-9-2"><a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="nv">LOCK_NAME</span><span class="o">=</span><span class="s2">"Archive-Update-in-Progress-</span><span class="si">${</span><span class="nv">MIRRORNAME</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-9-3"><a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="nv">LOCK</span><span class="o">=</span><span class="s2">"</span><span class="si">${</span><span class="nv">TO</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">LOCK_NAME</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-9-4"><a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="nv">UPDATEREQUIRED_NAME</span><span class="o">=</span><span class="s2">"Archive-Update-Required-</span><span class="si">${</span><span class="nv">MIRRORNAME</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-9-5"><a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="nv">UPDATEREQUIRED</span><span class="o">=</span><span class="s2">"</span><span class="si">${</span><span class="nv">TO</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">UPDATEREQUIRED_NAME</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-9-6"><a href="#__codelineno-9-6" id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="c1"># Used to make sure we will have the archive fully and completly synced before</span>
</span><span id="__span-9-7"><a href="#__codelineno-9-7" id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="c1"># we stop, even if we get multiple pushes while this script is running</span>
</span><span id="__span-9-8"><a href="#__codelineno-9-8" id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="c1"># Otherwise we can end up with a half-synced archive</span>
</span><span id="__span-9-9"><a href="#__codelineno-9-9" id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="c1"># - get a push</span>
</span><span id="__span-9-10"><a href="#__codelineno-9-10" id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="c1"># - sync, while locked</span>
</span><span id="__span-9-11"><a href="#__codelineno-9-11" id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="c1"># - get another push. Of course no extra sync run then happens, we are locked</span>
</span><span id="__span-9-12"><a href="#__codelineno-9-12" id="__codelineno-9-12" name="__codelineno-9-12"></a><span class="c1"># - done. Archive not correctly synced, we don't have all the changes from the second push</span>
</span><span id="__span-9-13"><a href="#__codelineno-9-13" id="__codelineno-9-13" name="__codelineno-9-13"></a>touch<span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">UPDATEREQUIRED</span><span class="si">}</span><span class="s2">"</span>
</span></code></pre></div>
<p>同步标记主要是用于<strong>记录</strong>新的推送并在下面的循环中处理，否则 <code>ftpsync</code> 同步过程中收到的推送会因为锁而被忽略。</p>
</li>
<li>
<p>使用锁检查是否有其他 <code>rsync</code> 正在工作</p>
</li>
<li>
<p>运行 <code>rsync</code>，以这个大循环为主体：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-10-1"><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="k">while</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-e<span class="w"> </span><span class="si">${</span><span class="nv">UPDATEREQUIRED</span><span class="si">}</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span></code></pre></div>
<ul>
<li>
<p>第一阶段：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-11-1"><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a>run_rsync<span class="w"> </span><span class="s2">"stage1"</span><span class="w"> </span><span class="si">${</span><span class="nv">RSYNC_OPTIONS1</span><span class="si">}</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nv">result</span><span class="o">=</span><span class="nv">$?</span>
</span></code></pre></div>
</li>
<li>
<p>第二阶段：首先确保上游镜像站已经完成同步，然后再进行同步</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-12-1"><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="k">for</span><span class="w"> </span>aupfile<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">TO</span><span class="si">}</span><span class="s2">/Archive-Update-in-Progress-"</span>*<span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-12-2"><a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">"</span><span class="nv">$aupfile</span><span class="s2">"</span><span class="w"> </span><span class="k">in</span>
</span><span id="__span-12-3"><a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="w">    </span>*<span class="o">)</span>
</span><span id="__span-12-4"><a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span>-f<span class="w"> </span><span class="nv">$aupfile</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-12-5"><a href="#__codelineno-12-5" id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="w">            </span><span class="c1"># Remove the file, it will be synced again if</span>
</span><span id="__span-12-6"><a href="#__codelineno-12-6" id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="w">            </span><span class="c1"># upstream is still not done</span>
</span><span id="__span-12-7"><a href="#__codelineno-12-7" id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="w">            </span>rm<span class="w"> </span>-f<span class="w"> </span><span class="s2">"</span><span class="nv">$aupfile</span><span class="s2">"</span>
</span><span id="__span-12-8"><a href="#__codelineno-12-8" id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="w">        </span><span class="k">fi</span>
</span><span id="__span-12-9"><a href="#__codelineno-12-9" id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="w">        </span><span class="nv">upstream_uip</span><span class="o">=</span><span class="nb">true</span>
</span><span id="__span-12-10"><a href="#__codelineno-12-10" id="__codelineno-12-10" name="__codelineno-12-10"></a><span class="w">        </span><span class="p">;;</span>
</span><span id="__span-12-11"><a href="#__codelineno-12-11" id="__codelineno-12-11" name="__codelineno-12-11"></a><span class="w">    </span><span class="k">esac</span>
</span><span id="__span-12-12"><a href="#__codelineno-12-12" id="__codelineno-12-12" name="__codelineno-12-12"></a><span class="k">done</span>
</span><span id="__span-12-13"><a href="#__codelineno-12-13" id="__codelineno-12-13" name="__codelineno-12-13"></a><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="si">${</span><span class="nv">upstream_uip</span><span class="si">}</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-12-14"><a href="#__codelineno-12-14" id="__codelineno-12-14" name="__codelineno-12-14"></a><span class="w">    </span>log<span class="w"> </span><span class="s2">"Upstream archive update in progress, skipping stage2"</span>
</span><span id="__span-12-15"><a href="#__codelineno-12-15" id="__codelineno-12-15" name="__codelineno-12-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="si">${</span><span class="nv">UPDATE_RETRIES</span><span class="si">}</span><span class="w"> </span>-lt<span class="w"> </span><span class="si">${</span><span class="nv">UIPRETRIES</span><span class="si">}</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-12-16"><a href="#__codelineno-12-16" id="__codelineno-12-16" name="__codelineno-12-16"></a><span class="w">        </span>log<span class="w"> </span><span class="s2">"Retrying update in </span><span class="si">${</span><span class="nv">UIPSLEEP</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-12-17"><a href="#__codelineno-12-17" id="__codelineno-12-17" name="__codelineno-12-17"></a><span class="w">        </span>sleep<span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">UIPSLEEP</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-12-18"><a href="#__codelineno-12-18" id="__codelineno-12-18" name="__codelineno-12-18"></a><span class="w">    </span><span class="k">fi</span>
</span><span id="__span-12-19"><a href="#__codelineno-12-19" id="__codelineno-12-19" name="__codelineno-12-19"></a><span class="k">else</span>
</span><span id="__span-12-20"><a href="#__codelineno-12-20" id="__codelineno-12-20" name="__codelineno-12-20"></a><span class="w">    </span><span class="c1"># We are lucky, it worked. Now do step 2 and sync again, this time including</span>
</span><span id="__span-12-21"><a href="#__codelineno-12-21" id="__codelineno-12-21" name="__codelineno-12-21"></a><span class="w">    </span><span class="c1"># the packages/releases files</span>
</span><span id="__span-12-22"><a href="#__codelineno-12-22" id="__codelineno-12-22" name="__codelineno-12-22"></a><span class="w">    </span>run_rsync<span class="w"> </span><span class="s2">"stage2"</span><span class="w"> </span><span class="si">${</span><span class="nv">RSYNC_OPTIONS2</span><span class="si">}</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nv">result</span><span class="o">=</span><span class="nv">$?</span>
</span><span id="__span-12-23"><a href="#__codelineno-12-23" id="__codelineno-12-23" name="__codelineno-12-23"></a><span class="k">fi</span>
</span></code></pre></div>
</li>
</ul>
</li>
<li>
<p>更新 trace 文件</p>
</li>
<li>
<p>去除锁</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-13-1"><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="c1"># Remove the Archive-Update-in-Progress file before we push our downstreams.</span>
</span><span id="__span-13-2"><a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a>rm<span class="w"> </span>-f<span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">LOCK</span><span class="si">}</span><span class="s2">"</span>
</span></code></pre></div>
</li>
</ul>
<aside class="md-source-file">
<span class="md-source-file__fact">
<span class="md-icon" title="Last update">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="May 3, 2025 15:46:23">May 3, 2025</span>
</span>
<span class="md-source-file__fact">
<span class="md-icon" title="Created">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="April 25, 2025 07:22:07">April 25, 2025</span>
</span>
<span class="md-source-file__fact">
<span class="md-icon" title="Contributors">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path></svg>
</span>
<span>GitHub</span>
<nav>
<a class="md-author" href="https://github.com/bowling233" title="@bowling233">
<img alt="bowling233" src="https://avatars.githubusercontent.com/u/35755846?v=4&amp;size=72"/>
</a>
</nav>
</span>
</aside>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: ZJU Mirror 历史" class="md-footer__link md-footer__link--prev" href="../mirror-history/">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                Previous
              </span>
<div class="md-ellipsis">
                ZJU Mirror 历史
              </div>
</div>
</a>
<a aria-label="Next: 优化方向概述" class="md-footer__link md-footer__link--next" href="../../optimization/">
<div class="md-footer__title">
<span class="md-footer__direction">
                Next
              </span>
<div class="md-ellipsis">
                优化方向概述
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      ZJUSCT
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "content.code.select", "content.code.annotate", "navigation.footer", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.tracking", "navigation.path", "navigation.top", "toc.follow", "content.action.edit", "search.suggest", "search.highlight", "search.share"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
<script src="../../javascripts/mathjax.js"></script>
<script src="https://cdn.jsdelivr.net/npm/polyfill/index.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tablesort/dist/tablesort.min.js"></script>
<script src="../../javascripts/tablesort.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script><script src="https://viewer.diagrams.net/js/viewer-static.min.js"></script></body>
</html>