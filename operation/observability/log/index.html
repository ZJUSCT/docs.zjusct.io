
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="ZJUSCT Documents & Blogs">
      
      
        <meta name="author" content="ZJUSCT">
      
      
        <link rel="canonical" href="https://docs.zjusct.io/operation/observability/log/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../network/">
      
      
      <link rel="icon" href="../../../assets/zjusct.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.12">
    
    
      
        <title>日志收集 - ZJUSCT 文档与博客</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.2afb09e1.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/fonts.css">
    
      <link rel="stylesheet" href="../../../stylesheets/counter.css">
    
      <link rel="stylesheet" href="../../../stylesheets/theme.css">
    
      <link rel="stylesheet" href="../../../stylesheets/neoteroi-v1.1.2.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="pink" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#日志收集" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="ZJUSCT 文档与博客" class="md-header__button md-logo" aria-label="ZJUSCT 文档与博客" data-md-component="logo">
      
  <img src="../../../assets/zjusct.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ZJUSCT 文档与博客
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              日志收集
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="pink" data-md-color-accent="indigo"  aria-label="切换至浅色模式"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="切换至浅色模式" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="zjusct" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="切换至深色模式"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="切换至深色模式" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="根据系统模式切换主题"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="根据系统模式切换主题" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/ZJUSCT/docs.zjusct.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    docs.zjusct.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
  
    
  
  首页

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../competition/" class="md-tabs__link">
          
  
  
    
  
  竞赛

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../falcon/" class="md-tabs__link">
          
  
  
    
  
  Falcon

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
    
  
  运维

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../blog/" class="md-tabs__link">
          
  
  
    
  
  博客

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="ZJUSCT 文档与博客" class="md-nav__button md-logo" aria-label="ZJUSCT 文档与博客" data-md-component="logo">
      
  <img src="../../../assets/zjusct.svg" alt="logo">

    </a>
    ZJUSCT 文档与博客
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ZJUSCT/docs.zjusct.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    docs.zjusct.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../.." class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    首页
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            首页
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index/contribute/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    贡献
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index/newcomer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ZJUSCT 集群新手指南
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../competition/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    竞赛
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            竞赛
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../falcon/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Falcon
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Falcon
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../falcon/git/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ZJU Git 代码托管服务
    
  </span>
  

      </a>
    </li>
  

              
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../falcon/mirror-history/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ZJU Mirror 历史
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../falcon/mirror/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ZJU Mirror 镜像站
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    运维
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            运维
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../hardware/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    硬件运维
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_2" id="__nav_4_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            硬件运维
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hardware/knowledge/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    硬件知识
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hardware/oobm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    带外管理
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    可观测性
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_3" id="__nav_4_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            可观测性
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    日志收集
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    日志收集
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#日志合规" class="md-nav__link">
    <span class="md-ellipsis">
      日志合规
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#日志通用知识和技能" class="md-nav__link">
    <span class="md-ellipsis">
      日志通用知识和技能
    </span>
  </a>
  
    <nav class="md-nav" aria-label="日志通用知识和技能">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#正则表达式" class="md-nav__link">
    <span class="md-ellipsis">
      正则表达式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#log-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      Log Rotation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#日志格式分析与处理" class="md-nav__link">
    <span class="md-ellipsis">
      日志格式分析与处理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="日志格式分析与处理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rfc-3164---the-bsd-syslog-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      RFC 3164 - The BSD Syslog Protocol
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rfc-5424---the-syslog-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      RFC 5424 - The Syslog Protocol
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux-日志系统" class="md-nav__link">
    <span class="md-ellipsis">
      Linux 日志系统
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Linux 日志系统">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#极限情况netconsole" class="md-nav__link">
    <span class="md-ellipsis">
      极限情况：netconsole
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bsd-风格klogd-与-syslog2" class="md-nav__link">
    <span class="md-ellipsis">
      BSD 风格：klogd 与 syslog(2)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#大一统systemd-journal" class="md-nav__link">
    <span class="md-ellipsis">
      大一统：systemd-journal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opentelemetry-收集-journal-日志" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry 收集 Journal 日志
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#应用日志适配" class="md-nav__link">
    <span class="md-ellipsis">
      应用日志适配
    </span>
  </a>
  
    <nav class="md-nav" aria-label="应用日志适配">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sssd" class="md-nav__link">
    <span class="md-ellipsis">
      sssd
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#munge" class="md-nav__link">
    <span class="md-ellipsis">
      munge
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exim4" class="md-nav__link">
    <span class="md-ellipsis">
      exim4
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nginx" class="md-nav__link">
    <span class="md-ellipsis">
      Nginx
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker" class="md-nav__link">
    <span class="md-ellipsis">
      Docker
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../network/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    网络观测
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../opentelemetry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    数据采集：OpenTelemetry
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../blog/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    博客
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            博客
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    posts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            posts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/posts/.template/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    None
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Archive
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#日志合规" class="md-nav__link">
    <span class="md-ellipsis">
      日志合规
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#日志通用知识和技能" class="md-nav__link">
    <span class="md-ellipsis">
      日志通用知识和技能
    </span>
  </a>
  
    <nav class="md-nav" aria-label="日志通用知识和技能">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#正则表达式" class="md-nav__link">
    <span class="md-ellipsis">
      正则表达式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#log-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      Log Rotation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#日志格式分析与处理" class="md-nav__link">
    <span class="md-ellipsis">
      日志格式分析与处理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="日志格式分析与处理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rfc-3164---the-bsd-syslog-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      RFC 3164 - The BSD Syslog Protocol
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rfc-5424---the-syslog-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      RFC 5424 - The Syslog Protocol
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux-日志系统" class="md-nav__link">
    <span class="md-ellipsis">
      Linux 日志系统
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Linux 日志系统">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#极限情况netconsole" class="md-nav__link">
    <span class="md-ellipsis">
      极限情况：netconsole
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bsd-风格klogd-与-syslog2" class="md-nav__link">
    <span class="md-ellipsis">
      BSD 风格：klogd 与 syslog(2)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#大一统systemd-journal" class="md-nav__link">
    <span class="md-ellipsis">
      大一统：systemd-journal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opentelemetry-收集-journal-日志" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry 收集 Journal 日志
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#应用日志适配" class="md-nav__link">
    <span class="md-ellipsis">
      应用日志适配
    </span>
  </a>
  
    <nav class="md-nav" aria-label="应用日志适配">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sssd" class="md-nav__link">
    <span class="md-ellipsis">
      sssd
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#munge" class="md-nav__link">
    <span class="md-ellipsis">
      munge
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exim4" class="md-nav__link">
    <span class="md-ellipsis">
      exim4
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nginx" class="md-nav__link">
    <span class="md-ellipsis">
      Nginx
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker" class="md-nav__link">
    <span class="md-ellipsis">
      Docker
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <nav class="md-tags" >
    
      
      
      
        <a href="../../../index/contribute/#tag:完善" class="md-tag">完善</a>
      
    
  </nav>


  
    <a href="https://github.com/ZJUSCT/docs.zjusct.io/blob/main/docs/operation/observability/log.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="日志收集">日志收集<a class="headerlink" href="#日志收集" title="Permanent link">&para;</a></h1>
<p>本文涉及日志格式、OpenTelemetry 日志采集与处理、ClickHouse 日志存储等内容。</p>
<p>在阅读本文前，请先阅读 <a href="../opentelemetry/">OpenTelemetry</a>。</p>
<h2 id="日志合规">日志合规<a class="headerlink" href="#日志合规" title="Permanent link">&para;</a></h2>
<p><a href="https://itc.zju.edu.cn/2017/0930/c50213a2508335/page.htm">浙江大学网络与信息安全管理办法（2017 年）</a></p>
<blockquote>
<p>第五条 信息技术中心负责学校网络与信息系统的日常管理和维护，保障网络与信息系统的正常运行；<strong>保存网络运行日志，配合调查取证</strong>；负责入网单位和个人办理入网登记手续，签署相应的安全责任书。</p>
<p>第二十三条 各单位对于主办的信息系统，每季度至少进行 1 次安全检查，填写检查台账（详见附件）。检查内容包括：</p>
<ul>
<li>（七）检查系统日志留存情况，<strong>留存相关日志不少于六个月</strong>。</li>
</ul>
</blockquote>
<p><a href="https://www.gov.cn/gongbao/content/2000/content_60531.htm">中华人民共和国国务院令（第 292 号）互联网信息服务管理办法</a></p>
<blockquote>
<p>第十四条 从事新闻、出版以及电子公告等服务项目的互联网信息服务提供者，应当记录提供的信息内容及其发布时间、互联网地址或者域名；互联网接入服务提供者应当记录上网用户的上网时间、用户帐号、互联网地址或者域名、主叫电话号码等信息。互联网信息服务提供者和互联网接入服务提供者的<strong>记录备份应当保存 60 日</strong>，并在国家有关机关依法查询时，予以提供。</p>
</blockquote>
<p><a href="https://www.gov.cn/gongbao/content/2006/content_421771.htm">中华人民共和国公安部令（第 82 号）互联网安全保护技术措施规定</a></p>
<blockquote>
<p>第十三条 互联网服务提供者和联网使用单位依照本规定落实的记录留存技术措施，应当具有至少<strong>保存六十天记录备份</strong>的功能。</p>
</blockquote>
<h2 id="日志通用知识和技能">日志通用知识和技能<a class="headerlink" href="#日志通用知识和技能" title="Permanent link">&para;</a></h2>
<p>如 <a href="https://www.fluentd.org/blog/unified-logging-layer">Unified Logging Layer: Turning Data into Action - Fluentd</a> 所说：</p>
<blockquote>
<p>In the last 10 years, <strong>the primary consumer of log data shifted from humans to machines.</strong></p>
<p>Software engineers still read logs, especially when their software behaves in an unexpected manner. However, in terms of "bytes processed", humans account for a tiny fraction of the total consumption. Machines, not humans, are crunching log data day and night to generate reports and run statistical calculations to help us make decisions. The insights derived from log data used to be post hoc, pull and episodic. Today, it is ad hoc, push and statistical.</p>
<p>Undoubtedly, Moore's Law and the advances in distributed systems design have made large-scale log processing and data mining accessible. However, many organizations, even with abundant financial and human capital, fail to turn their rapidly growing log data into actionable insights. Why can't they get value from their log data if all the pieces are available and affordable?</p>
<p><strong>That's because legacy logging infrastructure was NOT designed to be "machine-first", and so much effort is wasted trying to make various backend systems understand log data.</strong></p>
</blockquote>
<p>传统的日志基础设施并不是为“机器优先”设计的，大量的工作都花在了让后端系统理解日志数据上。本章介绍几种常见的日志格式，并分析如何使用 OpenTelemetry Collector 进行日志处理。</p>
<h3 id="正则表达式">正则表达式<a class="headerlink" href="#正则表达式" title="Permanent link">&para;</a></h3>
<p>日志消息十分依赖正则表达式进行解析。OpenTelemetry Collector 的正则表达式基于 Golang 风格。</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul>
<li>把日志喂给 AI，让它帮你写正则表达式。</li>
<li>使用 <a href="https://regex101.com/?flavor=golang">regex101</a> 进行编写和调试。</li>
<li>使用 <a href="https://regex.rip/">regex.rip</a> 测试正则表达式是否脆弱、易受攻击。</li>
</ul>
</div>
<h3 id="log-rotation">Log Rotation<a class="headerlink" href="#log-rotation" title="Permanent link">&para;</a></h3>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<ul>
<li><a href="https://grafana.com/docs/loki/latest/send-data/promtail/logrotation/">Log Rotation - Grafana Loki documentation</a>：清晰地讲解了日志轮转的原理。</li>
</ul>
</div>
<p>在讲解日志格式和处理前，先了解一个通用的日志操作：日志轮转（Log Rotation）。</p>
<p>基于文件的日志系统会随着时间的推移不断增大，单个文件的大小会变得无法接受。为了解决这个问题，可以定期将日志文件重命名并创建新的日志文件。</p>
<p>日志轮转主要有两种方式：Copy and Truncate 和 Rename and Create。过程中有三个角色：appender 生成日志、rotator 轮转日志、tailer 读取日志。</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>tailer 这个名称来自于 <code>tail</code> 命令，程序员们经常使用 <code>tail -f</code> 命令来查看日志文件的末尾。</p>
</div>
<figure>
<a class="glightbox" href="../log.assets/logrotation-copy-and-truncate.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Copy and truncate log rotation" src="../log.assets/logrotation-copy-and-truncate.png" style="float: left;" width="50%" /></a>
<a class="glightbox" href="../log.assets/logrotation-rename-and-create.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Rename and create log rotation" src="../log.assets/logrotation-rename-and-create.png" style="float: right;" width="50%" /></a>
</figure>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>小知识：Linux 文件句柄在文件移动和删除时仍然有效，且保持打开状态（同一个文件系统中）。</p>
</div>
<p>可以看到，在两种方式下，旧日志的文件句柄都是保持的，因此不用担心轮转的日志末尾丢失。</p>
<details class="info">
<summary>logrotate 工具</summary>
<p>在传统的 Linux 系统运维中，日志轮转一般使用 <a href="https://github.com/logrotate/logrotate"><code>logrotate</code></a> 工具实现。比如下面是镜像站曾经的日志轮转配置：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>/var/log/nginx/*.log {
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>        daily
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>        missingok
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>        rotate 14
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>        compress
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>        delaycompress
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>        notifempty
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>        create 0640 www-data adm
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>        sharedscripts
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>        prerotate
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>                if [ -d /etc/logrotate.d/httpd-prerotate ]; then \
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>                        run-parts /etc/logrotate.d/httpd-prerotate; \
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>                fi \
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>        endscript
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>        postrotate
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>                invoke-rc.d nginx rotate &gt;/dev/null 2&gt;&amp;1
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>        endscript
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>}
</span></code></pre></div>
</details>
<p>现在，我们使用 OpenTelemetry Collector 的 FileLogReceiver 来读取日志。FileLogReceiver 支持日志轮转操作。</p>
<details class="info">
<summary>tailer 简析：以 fileconsumer 为例</summary>
<p>OpenTelemetry 的 FileLogReceiver 使用 <code>pkg/stanza/fileconsumer</code> 实现日志文件的读取。<a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/pkg/stanza/fileconsumer/design.md"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></span> pkg/stanza/fileconsumer/design.md</a> 描述了其工作原理。</p>
<p>一些概念：</p>
<ul>
<li><strong>指纹</strong>：文件的前 <code>N</code> 个字节，用于标识文件，默认为 <code>1000</code> 即约 1KB。指纹相同的文件视为同一文件。<ul>
<li>长度未达到限制时采用前缀比较。</li>
<li>文件增长时更新指纹。</li>
<li>能够处理 Copy and Truncate 的 rotate 操作。尽力在读取新文件前读到旧文件的末尾（这意味着如果文件日志没有时间戳信息，可能会乱序）。</li>
</ul>
</li>
<li><strong>Reader</strong>：文件句柄、指纹、偏移量、路径等。<ul>
<li>文件句柄关闭时 Reader 不会立即消失，在固定次数的轮询中仍然保持，用于监测文件删除或拷贝、获取文件曾经的路径等。</li>
<li>可以将其持久化保存，下一次启动时恢复读取状态。</li>
</ul>
</li>
</ul>
<blockquote>
<p>虽然笔者感觉文件指纹的实现有一些草率且效率不高（和 FileBeats 的 inode 比起来），但似乎不会出什么大问题。</p>
</blockquote>
<p><code>fileconsumer</code> 按一定时间间隔扫描文件系统。每次轮询的步骤：</p>
<ol>
<li><strong>匹配</strong>：扫描匹配的文件列表。</li>
<li><strong>列队</strong>：如果文件数量超过最大并发数，则文件列表分成两部分。本次轮询间隔内处理前一部分。后一部分进入队列，下一次轮询直接从队列中拿文件，直到队列为空。</li>
<li><strong>打开文件</strong>：此时文件可能被移动或删除。</li>
<li><strong>计算指纹</strong></li>
<li><strong>排除（关闭文件）</strong>：本批次的指纹交叉比对，重复文件被排除。</li>
<li><strong>创建 Reader</strong>：交叉比对已有 Reader 的指纹，拷贝上次迭代的 Reader，否则初始化。</li>
<li><strong>检查 Lost file</strong>：如果指纹能匹配到前一轮，但不能匹配到本轮，被认为是 Lost file。可能由于文件删除、移动或 rotate。</li>
<li><strong>读取文件</strong>：<ul>
<li><strong>读取 Lost file</strong>：<ul>
<li>如果文件被删除，操作失败。</li>
<li>如果被移动，有可能继续读取剩余部分。</li>
</ul>
</li>
<li>所有文件并发读取。</li>
</ul>
</li>
<li><strong>关闭文件</strong>。</li>
<li><strong>归档 Reader</strong>。</li>
<li>超过 3 个周期的 Reader 被移除。</li>
<li>如果配置了持久化，保存 Reader 状态。</li>
</ol>
</details>
<h2 id="日志格式分析与处理">日志格式分析与处理<a class="headerlink" href="#日志格式分析与处理" title="Permanent link">&para;</a></h2>
<h3 id="rfc-3164---the-bsd-syslog-protocol"><a href="https://tools.ietf.org/html/rfc3164">RFC 3164 - The BSD Syslog Protocol</a><a class="headerlink" href="#rfc-3164---the-bsd-syslog-protocol" title="Permanent link">&para;</a></h3>
<ul>
<li>发布于 2001 年。目前几乎所有硬件设施都支持 RFC 3164。</li>
<li>规定目标为 UDP 端口 514 的数据包为 syslog 消息。</li>
<li>消息由三个部分组成：<ul>
<li>PRI：<code>&lt;FACILITY*8 + SEVERITY&gt;</code>：<code>FACILITY</code> 是消息来源，<code>SEVERITY</code> 是消息严重程度。</li>
<li>HEADER：<code>TIMESTAMP HOSTNAME</code>：时间戳和主机名。<ul>
<li><code>TIMESTAMP</code> 紧接在 <code>&gt;</code> 后，格式为 <code>Mmm dd hh:mm:ss</code>，例子：<code>Aug  8 17:44:32</code>。</li>
</ul>
</li>
<li>MSG：<code>TAG CONTENT</code>。<code>TAG</code> 是有关进程的标识符，可以是程序名或者进程 ID。</li>
</ul>
</li>
<li>没有规定日志内容格式（指 <code>CONTENT</code> 的内容），只约定传输消息的协议。</li>
</ul>
<div class="admonition example">
<p class="admonition-title">TP-Link 日志</p>
<p>以 TL-R473G 为例，勾选发送系统日志之后，可以在服务器上收到日志消息（由于消息 <code>CONTENT</code> 部分包含中文，显示为乱码）：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>User Datagram Protocol, Src Port: 44144, Dst Port: 514
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>Syslog message: USER.NOTICE: Aug 08 18:22:15 TL-R473G 625: 2024-08-08 18:22:15 &lt;5&gt; :  DHCP������Ϊlan�ڿͻ�MAC B6-10-DE-B4-DF-7D ������IP��ַ192.168.1.4
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    0000 1... = Facility: USER - random user-level messages (1)
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>    .... .101 = Level: NOTICE - normal but significant condition (5)
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    Message: Aug 08 18:22:15 TL-R473G 625: 2024-08-08 18:22:15 &lt;5&gt; :  DHCP������Ϊlan�ڿͻ�MAC B6-10-DE-B4-DF-7D ������IP��ַ192.168.1.4
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>        Syslog timestamp (RFC3164): Aug 08 18:22:15
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>        Syslog hostname: TL-R473G
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>        Syslog process id: 625
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>        Syslog message id: : 2024-08-08 18:22:15 &lt;5&gt; :  DHCP��������lan������MAC B6-10-DE-B4-DF-7D ������IP����192.168.1.4
</span></code></pre></div>
<p>可以看到消息使用了 RFC 3164 的格式。</p>
</div>
<div class="admonition example">
<p class="admonition-title">华为日志</p>
<p>华为设备的网络日志配置一般在 <strong>信息中心（info-center）</strong> 模块下。默认使用 UDP，可以配置 TCP SSL。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>User Datagram Protocol, Src Port: 60936, Dst Port: 514
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>Syslog message: LOCAL7.NOTICE: Aug  8 2024 11:44:37 Router %%01SHELL/5/CMDRECORD(l)[1]:Record command information. (Task=vt0, Ip=***.***.***.***, User=******, Command=&quot;return&quot;, Result=Success)
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    1011 1... = Facility: LOCAL7 - reserved for local use (23)
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    .... .101 = Level: NOTICE - normal but significant condition (5)
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    Message: Aug  8 2024 11:44:37 Router %%01SHELL/5/CMDRECORD(l)[1]:Record command information. (Task=vt0, Ip=***.***.***.***, User=******, Command=&quot;return&quot;, Result=Success)
</span></code></pre></div>
<p>可以看到这也是 RFC 3164 的格式。</p>
</div>
<div class="admonition example">
<p class="admonition-title">浪潮服务器日志</p>
<p>上面两个例子都是 UDP，这次我们来试试 TCP。</p>
<p>浪潮 M6 服务器 BMC 可以选择 TCP 方式发送日志消息（不使用 TLS）。使用 TCP 方式意味着必须有一个服务端允许建立 TCP 连接，否则消息无法发送。我们可以在 Windows 上安装 <a href="https://github.com/MaxBelkov/visualsyslog">MaxBelkov/visualsyslog</a>（一个轻量级的 syslog 工具，支持 TCP 和 UDP）来接收日志消息。</p>
<p>通过 Wireshark 抓包，可以看到如下过程：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>Src    Dest   Pro Info
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>Client Server TCP 59382  &gt;  514 [SYN]
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>Server Client TCP 514  &gt;  59382 [SYN, ACK]
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>Client Server TCP 59382  &gt;  514 [ACK]
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>Client Server RSH Client -&gt; Server data
</span></code></pre></div>
<p>消息被 Wireshark 识别为 RSH，但实际上是 syslog 消息，可以从解析的数据看到消息内容：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>&lt;190&gt;Aug  8 17:44:32 221823342 221823342:  Syslog Destination 0 Test Sent Successfully!
</span></code></pre></div>
<p>这也是 RFC 3164 的格式。</p>
</div>
<div class="admonition tip">
<p class="admonition-title">坑人的产商</p>
<p>华子，说的就是你。</p>
<p>华为的 syslog 消息中，TIMESTAMP 并不严格遵循 RFC 的格式。默认为 <code>Aug  8 2024 11:44:37</code>，多了一个年份。这样的消息在一些日志分析工具中会被识别为错误格式，导致无法解析。</p>
<p>我们在配置 OTel Collector Receiver 时碰到了这样的问题，见 <a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/issues/33344"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></span> syslog receiver Error expecting a Stamp timestamp [col 5] · Issue #33344 · open-telemetry/opentelemetry-collector-contrib</a>。</p>
<blockquote>
<p>After reading RFC 3164, I found that the issue occurs because HUAWEI does not follow the TIMESTAMP field format as defined in the RFC. According to RFC 3164, the TIMESTAMP field should be in the format <code>Mmm dd hh:mm:ss</code>, but HUAWEI adds the year (<code>YYYY</code>) between <code>Mmm</code> and <code>dd</code>, which causes the FSM (Finite State Machine) in <code>go-syslog</code> to fail.</p>
<p>HUAWEI defines multiple timestamp formats: <code>mm dd yyyy hh:mm:ss</code> is referred to as the "date" type and is set as the default. However, they also provide a "short-date" type that adheres to RFC 3164. After configuring it to use the "short-date" format, the error was resolved.</p>
</blockquote>
</div>
<p>OTel Collector 提供 <a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/receiver/syslogreceiver/README.md">Syslog Receiver</a> 解析 syslog 消息：</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nt">syslog</span><span class="p">:</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">  </span><span class="nt">udp</span><span class="p">:</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">    </span><span class="nt">listen_address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">otel-collector:514</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">    </span><span class="nt">add_attributes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">    </span><span class="nt">one_log_per_packet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">  </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rfc3164</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">  </span><span class="c1"># we configure all infrastructure to use the same timezone UTC +8</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">  </span><span class="nt">location</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Asia/Shanghai</span>
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">配置时间</p>
<p>为方便运维，我们约定，软硬件设备统一使用 <code>time.zju.edu.cn</code> 作为 NTP 服务器，时区配置为东八区。部分硬件设备在上报日志时可能会使用 UTC 时间，需要注意配置。例如，华为信息中心发送日志时需要制定 <code>local-time</code> 参数，否则发送 UTC 时间。</p>
</div>
<p>该 Receiver 解析的消息格式如下所示。原始消息内容保存在 Body，提取出 <code>PRI</code>、<code>TIMESTAMP</code> 等 RFC 中定义的字段作为 Attributes。<code>net</code> 开头的字段是通过 <code>add_attributes: true</code> 指定添加的。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>ObservedTimestamp: 2024-10-04 15:46:26.809948211 +0000 UTC
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>Timestamp: 2024-10-04 15:46:14 +0000 UTC
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>SeverityText: notice
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>SeverityNumber: Info2(10)
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>Body: Str(&lt;189&gt;Oct  4 23:46:14 Huawei %%01SHELL/5/CMDRECORD(l)[324]:Record command information. (Task=vt0, Ip=192.168.1.178, User=admin, Command=&quot;log off (ssh user)&quot;, Result=Success) )
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>Attributes:
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>     -&gt; net.host.port: Str(514)
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>     -&gt; net.peer.name: Str(192.168.1.1)
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>     -&gt; appname: Str(%%01SHELL/5/CMDRECORD(l))
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>     -&gt; net.transport: Str(IP.UDP)
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>     -&gt; net.host.name: Str(c91dcf42473a)
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>     -&gt; net.peer.port: Str(49377)
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>     -&gt; proc_id: Str(324)
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>     -&gt; hostname: Str(Huawei)
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>     -&gt; net.host.ip: Str(172.21.0.2)
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>     -&gt; message: Str(324]:Record command information. (Task=vt0, Ip=192.168.1.178, User=admin, Command=&quot;log off (ssh user)&quot;, Result=Success) )
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>     -&gt; priority: Int(189)
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>     -&gt; net.peer.ip: Str(192.168.1.1)
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>     -&gt; facility: Int(23)
</span></code></pre></div>
<p>可以使用 Operator 继续解析消息内容。比如<a href="https://support.huawei.com/enterprise/zh/doc/EDOC1100381902/a91516b6">华为日志格式</a>中，<code>TAG</code> 部分字段如下：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>字段含义</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>%%</td>
<td>华为公司的标识</td>
<td>标识该 Log 信息是由华为公司的产品输出的。</td>
</tr>
<tr>
<td>dd</td>
<td>版本号</td>
<td>标识该 Log 信息格式的版本。</td>
</tr>
<tr>
<td>ModuleName</td>
<td>模块名</td>
<td>向信息中心输出信息的模块名称。</td>
</tr>
<tr>
<td>Serverity</td>
<td>日志的级别</td>
<td>Log 信息的级别。</td>
</tr>
<tr>
<td>Brief</td>
<td>简要描述</td>
<td>Log 信息的简要解释。</td>
</tr>
<tr>
<td>(l)</td>
<td>信息的类别</td>
<td>信息的类型有：l：Log 信息。S：安全日志信息。D：诊断日志信息。</td>
</tr>
</tbody>
</table>
<p>我们可以继续从中提取出模块名、日志级别和简要描述：</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nt">operators</span><span class="p">:</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">router</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span><span class="nt">routes</span><span class="p">:</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">huawei_add_resource</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">        </span><span class="c1"># before escape: %%\d+[^\/]+\/\d+\/.+\(.+\)</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">        </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;attributes.appname</span><span class="nv"> </span><span class="s">matches</span><span class="nv"> </span><span class="s">&quot;%%\\d+[^\\/]+\\/\\d+\\/.+\\(.+\\)&quot;&#39;</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">    </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">noop</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">huawei_add_resource</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">add</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">    </span><span class="nt">field</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">resource.device.manufacturer</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Huawei</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">huawei_regex_parser</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">huawei_regex_parser</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">regex_parser</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="w">    </span><span class="nt">parse_from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">attributes.appname</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="w">    </span><span class="nt">parse_to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">attributes.huawei</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="w">    </span><span class="nt">regex</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;%%(?P&lt;version&gt;\d+)(?P&lt;module_name&gt;[^\/]+)\/(?P&lt;serverity&gt;\d+)\/(?P&lt;brief&gt;.+)\((?P&lt;type&gt;.+)\)&#39;</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">noop</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">noop</span>
</span></code></pre></div>
<p>提取结果如下：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>-&gt; huawei: Map({&quot;brief&quot;:&quot;USER_OFFLINERESULT&quot;,&quot;module_name&quot;:&quot;CM&quot;,&quot;serverity&quot;:&quot;5&quot;,&quot;type&quot;:&quot;s&quot;,&quot;version&quot;:&quot;01&quot;})
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">华子真挺坑的</p>
<p>华为不同设备不同系统版本日志结构可能不一样，需要根据实际情况调整解析规则。</p>
</div>
<h3 id="rfc-5424---the-syslog-protocol"><a href="https://tools.ietf.org/html/rfc5424">RFC 5424 - The Syslog Protocol</a><a class="headerlink" href="#rfc-5424---the-syslog-protocol" title="Permanent link">&para;</a></h3>
<div class="admonition tip">
<p class="admonition-title">本节可以跳过</p>
<p>我们还没接触过使用 RFC 5424 的设备。</p>
</div>
<ul>
<li>发布于 2009 年。在 RFC 3164 的基础上定义结构化消息格式，为整体架构分层。各层之间独立：<ul>
<li><code>content</code> 层：内容。</li>
<li><code>application</code>：生成、翻译、路由、存储。</li>
<li><code>transport</code>：传输，比如现在可以使用 UDP 之外的协议，建议使用 TLS 为基础的协议。</li>
</ul>
</li>
<li>
<p>结构化消息使用 ABNF（扩展的 BNF，一种语法表示方法）定义，几个重要的部分如下，其他请参考 RFC 文档。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>SYSLOG-MSG      = HEADER SP STRUCTURED-DATA [SP MSG]
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>HEADER          = PRI VERSION SP TIMESTAMP SP HOSTNAME SP APP-NAME SP PROCID SP MSGID
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>MSG             = MSG-ANY / MSG-UTF8
</span></code></pre></div>
<p>可以看到，<code>SYSLOG-MSG</code> 展开后为 <code>PRI VERSION TIMESTAMP HOSTNAME APP-NAME PROCID MSGID [STRUCTURED-DATA] [MSG]</code>，整体上与 RFC 3164 的消息格式类似，只是多了结构化数据的部分。</p>
</li>
<li>
<p>支持截断分段传输。</p>
</li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc5426">RFC 5426 - Transmission of Syslog Messages over UDP</a> 主要是说了分段传输的问题（比如 MTU），没什么好看的。</li>
<li><a href="https://datatracker.ietf.org/doc/html/rfc5425">RFC 5425 - Transport Layer Security (TLS) Transport Mapping for Syslog</a> 定义了 syslog over TLS 的传输方式，端口为 6514。</li>
</ul>
<h3 id="linux-日志系统">Linux 日志系统<a class="headerlink" href="#linux-日志系统" title="Permanent link">&para;</a></h3>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<ul>
<li><a href="https://unix.stackexchange.com/questions/205883/understand-logging-in-linux/294206#294206">Understand logging in Linux - StackExchange</a>：概述了从过去的 BSD 风格到现在的 systemd 日志系统。</li>
</ul>
</div>
<p>在 Linux 系统中，<strong>内核与普通应用的日志系统是分开的</strong>。内核日志由 klogd 守护进程收集，普通应用日志由 syslogd 守护进程收集。在现代 Linux 发行版中，klogd 和 syslogd 都已经被 systemd-journald 取代。</p>
<h4 id="极限情况netconsole">极限情况：netconsole<a class="headerlink" href="#极限情况netconsole" title="Permanent link">&para;</a></h4>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<ul>
<li><a href="https://www.kernel.org/doc/Documentation/networking/netconsole.txt">kernel.org/doc/Documentation/networking/netconsole.txt</a></li>
</ul>
</div>
<p>当磁盘无法写入日志且无法进行串口调试时，可以使用 netconsole 内核模块将日志通过网络发送到另一台机器。然而，它的使用限制也不少，比如不会等待网络接口 up。大多数交换机启用生成树功能，网口 up 时都会有一段等待时间，且 DHCP 响应也没有那么快，很容易错过系统启动时密集的信息。</p>
<h4 id="bsd-风格klogd-与-syslog2">BSD 风格：klogd 与 syslog(2)<a class="headerlink" href="#bsd-风格klogd-与-syslog2" title="Permanent link">&para;</a></h4>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<ul>
<li>The Linux Programming Interface: 37.5 Logging Messages and Errors Using syslog</li>
</ul>
</div>
<p>klogd 是内核日志守护进程，收集内核使用 <code>printk()</code> 输出的日志消息。这些消息可能通过 <code>/proc/kmsg</code> 文件或 syslog(2) 系统调用收集。</p>
<p>syslog 由两个部分组成：syslogd 守护进程和 syslog(3) 库函数。</p>
<ul>
<li>syslogd：接收、过滤和处理、发送日志消息（BSD 风格）<ul>
<li>接收日志消息：<code>/dev/log</code>、UDP 514 端口</li>
<li>日志消息的属性：<ul>
<li><code>facility</code>：来源</li>
<li><code>level</code>：严重程度</li>
</ul>
</li>
<li>配置文件：<code>/etc/syslog.conf</code></li>
</ul>
</li>
<li>
<p>syslog(3) 库函数：构造消息发送到 <code>/dev/log</code>，看看 GNU 的例子：</p>
<div class="language-c highlight"><span class="filename">Syslog Example (The GNU C Library)</span><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;syslog.h&gt;</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="n">setlogmask</span><span class="w"> </span><span class="p">(</span><span class="n">LOG_UPTO</span><span class="w"> </span><span class="p">(</span><span class="n">LOG_NOTICE</span><span class="p">));</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="n">openlog</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;exampleprog&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LOG_CONS</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">LOG_PID</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">LOG_NDELAY</span><span class="p">,</span><span class="w"> </span><span class="n">LOG_LOCAL1</span><span class="p">);</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="n">syslog</span><span class="w"> </span><span class="p">(</span><span class="n">LOG_NOTICE</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Program started by User %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">getuid</span><span class="w"> </span><span class="p">());</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="n">syslog</span><span class="w"> </span><span class="p">(</span><span class="n">LOG_INFO</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;A tree falls in a forest&quot;</span><span class="p">);</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="n">closelog</span><span class="w"> </span><span class="p">();</span>
</span></code></pre></div>
</li>
<li>
<p>logger(1) 命令：用于向 syslog 发送消息</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>logger<span class="w"> </span>-p<span class="w"> </span>user.notice<span class="w"> </span><span class="s2">&quot;Hello, world!&quot;</span>
</span></code></pre></div>
</li>
</ul>
<h4 id="大一统systemd-journal">大一统：systemd-journal<a class="headerlink" href="#大一统systemd-journal" title="Permanent link">&para;</a></h4>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<ul>
<li><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd-journald.service.html">systemd-journald.service(8) - FreeDesktop</a></li>
<li><a href="https://www.freedesktop.org/software/systemd/man/latest/systemd.journal-fields.html">systemd.journal-fields - freedesktop.org</a>：字段列表。</li>
<li><a href="https://unix.stackexchange.com/questions/332274/is-systemd-journald-a-syslog-implementation">Is systemd-journald a syslog implementation?</a>：解释了 systemd-journald 与 syslogd 的关系</li>
<li><a href="https://stackoverflow.com/questions/73551012/why-syslogs-from-a-program-is-watched-from-the-journal-command">Why Syslogs from a program is watched from the journal command? - StackOverflow</a>：分析了消息经过 systemd-journald 的流程</li>
</ul>
</div>
<p>现在大部分发行版都已经使用 systemd-journald 作为日志守护进程，它接管了 syslogd 的大部分功能，并提供了更多的特性。比如：</p>
<ul>
<li><code>sd_journal_send()</code>：库函数</li>
<li><code>/run/systemd/journal/socket</code>：基于 systemd native journal protocol 的套接字，它通过链接取代了 <code>/dev/log</code>。</li>
<li><code>StandardOutput/StandardError=journal</code>：默认，启动服务时将 stdout/stderr 重定向到 journal</li>
<li><a href="https://systemd.io/JOURNAL_NATIVE_PROTOCOL/">Native Journal Protocol - systemd</a>：journal 的原生协议</li>
<li><code>/etc/systemd/journald.conf</code>：配置文件</li>
</ul>
<p>在搭载 systemd 的发行版上，systemd-journald 就是日志守护进程。日志消息可以使用 <code>journalctl</code> 查看，其中包含了内核日志。日志消息的流向如下：</p>
<pre class="mermaid"><code>graph
 A["syslog()"]
 B["/dev/log"]
 C["/run/systemd/journal/dev-log"]
 D["systemd-journald"]
 E["/run/systemd/journal/syslog&lt;br/&gt;如果有服务监听才会出现"]
 F[（一般不存在）&lt;br/&gt;rsyslogd 等日志守护进程]
 G["内核日志"]
 H["/dev/kmsg"]

 G["printk()&lt;br/&gt;系统调用"] --&gt;|写入| H
 H["/dev/kmsg&lt;br/&gt;字符设备"] --&gt; D
 A["syslog()&lt;br/&gt;库函数"] --&gt;|写入| B
 B["/dev/log&lt;br&gt;符号链接"] --&gt; C
 C["/run/systemd/journal/dev-log&lt;br&gt;套接字"] --&gt; D
 D --&gt;|Forward| E
 E --&gt; F
 n1["systemd 服务&lt;br/&gt;stdout/stderr"]
 n1 ---|重定向| n2["/run/systemd/journal/stdout&lt;br/&gt;套接字"]
 n2 --- D
 n3["sd_journal_sendv()&lt;br&gt;systemd库函数"]
 n4["/run/systemd/journal/socket&lt;br/&gt;套接字"]
 n3 --- n4
 n4 --- D
 n5["system.journal&lt;br&gt;压缩的日志文件"]
 D ---|Storage=volatile| n6["/run/log/journal/*"]
 n6 --- n5
 D ---|Storage=persistent| n7["/var/log/journal/*"]
 n7 --- n5
 n5 ---|log rotation| n8["system@*.journal"]</code></pre>
<p>systemd-journald 的默认行为是将日志持久化存储在 <code>/var/log/journal</code> 目录下。一般机器一个月可以产生 2GB 的日志。在无盘系统和日志集中化的集群中，一般选择将日志存储配置到内存中：</p>
<div class="language-text highlight"><span class="filename">/etc/systemd/journald.conf.d/diskless.conf</span><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>[Journal]
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>Storage=volatile
</span></code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>systemd-journald 的大一统也意味着，如果它挂掉，使用日志的程序都会收到 <code>EPIPE</code> 错误，可能导致系统崩溃。</p>
</div>
<p>journal 的字段分为两类，举例如下：</p>
<ul>
<li>
<p>用户字段（User Journal Field）：从客户端发送。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>MESSAGE UNIT SYSLOG_IDENTIFIER SYSLOG_PID SYSLOG_TIMESTAMP
</span></code></pre></div>
</li>
<li>
<p>可信字段（Trusted Journal Field）：以 <code>_</code> 开头，由 systemd 生成，不允许用户发送。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>_MACHINE_ID _HOSTNAME _TRANSPORT _UID _GID _CAP_EFFECTIVE
</span></code></pre></div>
<p>其中，<code>_TRANSPORT</code> 表示消息是通过什么方式发送的：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>audit driver syslog journal stdout kernel
</span></code></pre></div>
</li>
</ul>
<h4 id="opentelemetry-收集-journal-日志">OpenTelemetry 收集 Journal 日志<a class="headerlink" href="#opentelemetry-收集-journal-日志" title="Permanent link">&para;</a></h4>
<p>OpenTelemetry 提供 <a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/journaldreceiver">Journald Receiver</a>，从指定位置（<code>/run/log/journal</code>）以文件方式采集 journal。Journald Receiver 依赖 stanza 中的 <a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/pkg/stanza/docs/operators/journald_input.md"><code>journald_input</code> Operator</a>。</p>
<p>Journald Receiver 将 <code>__REALTIME_TIMESTAMP</code> 解析为时间戳，其他字段解析到 <code>body</code>。</p>
<details class="example">
<summary>Example</summary>
<div class="language-json highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="p">{</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">    </span><span class="nt">&quot;MESSAGE&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uid 1000 is trying to obtain org.freedesktop.packagekit.system-sources-refresh auth (only_trusted:0)&quot;</span><span class="p">,</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">    </span><span class="nt">&quot;PRIORITY&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;6&quot;</span><span class="p">,</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">    </span><span class="nt">&quot;SYSLOG_FACILITY&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;4&quot;</span><span class="p">,</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">    </span><span class="nt">&quot;SYSLOG_IDENTIFIER&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PackageKit&quot;</span><span class="p">,</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">    </span><span class="nt">&quot;SYSLOG_TIMESTAMP&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Oct  4 11:22:56 &quot;</span><span class="p">,</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">    </span><span class="nt">&quot;_BOOT_ID&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0907452f07224388b86d177c9bcba765&quot;</span><span class="p">,</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w">    </span><span class="nt">&quot;_CAP_EFFECTIVE&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1ffffffffff&quot;</span><span class="p">,</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="w">    </span><span class="nt">&quot;_CMDLINE&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/usr/libexec/packagekitd&quot;</span><span class="p">,</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="w">    </span><span class="nt">&quot;_COMM&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;packagekitd&quot;</span><span class="p">,</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w">    </span><span class="nt">&quot;_EXE&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/usr/libexec/packagekitd&quot;</span><span class="p">,</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="w">    </span><span class="nt">&quot;_GID&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="w">    </span><span class="nt">&quot;_HOSTNAME&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bowling-pc&quot;</span><span class="p">,</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="w">    </span><span class="nt">&quot;_MACHINE_ID&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;39242ca0196f43d9a28b324ea19f63b0&quot;</span><span class="p">,</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="w">    </span><span class="nt">&quot;_PID&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;23670&quot;</span><span class="p">,</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="w">    </span><span class="nt">&quot;_RUNTIME_SCOPE&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;system&quot;</span><span class="p">,</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="w">    </span><span class="nt">&quot;_SELINUX_CONTEXT&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;unconfined\n&quot;</span><span class="p">,</span>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="w">    </span><span class="nt">&quot;_SOURCE_REALTIME_TIMESTAMP&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1728012176868714&quot;</span><span class="p">,</span>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="w">    </span><span class="nt">&quot;_SYSTEMD_CGROUP&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/system.slice/packagekit.service&quot;</span><span class="p">,</span>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a><span class="w">    </span><span class="nt">&quot;_SYSTEMD_INVOCATION_ID&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;67439263558c436c94d6c87449f7fe9c&quot;</span><span class="p">,</span>
</span><span id="__span-16-21"><a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a><span class="w">    </span><span class="nt">&quot;_SYSTEMD_SLICE&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;system.slice&quot;</span><span class="p">,</span>
</span><span id="__span-16-22"><a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a><span class="w">    </span><span class="nt">&quot;_SYSTEMD_UNIT&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;packagekit.service&quot;</span><span class="p">,</span>
</span><span id="__span-16-23"><a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a><span class="w">    </span><span class="nt">&quot;_TRANSPORT&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;syslog&quot;</span><span class="p">,</span>
</span><span id="__span-16-24"><a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a><span class="w">    </span><span class="nt">&quot;_UID&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
</span><span id="__span-16-25"><a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a><span class="w">    </span><span class="nt">&quot;__CURSOR&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s=05e12a7b0f87409384f87fd68c304adb;i=c29c;b=0907452f07224388b86d177c9bcba765;m=151a3935;t=6239e2ff84597;x=b0b45b19b90a570f&quot;</span><span class="p">,</span>
</span><span id="__span-16-26"><a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a><span class="w">    </span><span class="nt">&quot;__MONOTONIC_TIMESTAMP&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;354040117&quot;</span><span class="p">,</span>
</span><span id="__span-16-27"><a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a><span class="w">    </span><span class="nt">&quot;__SEQNUM&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;49820&quot;</span><span class="p">,</span>
</span><span id="__span-16-28"><a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a><span class="w">    </span><span class="nt">&quot;__SEQNUM_ID&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;05e12a7b0f87409384f87fd68c304adb&quot;</span>
</span><span id="__span-16-29"><a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a><span class="p">}</span>
</span></code></pre></div>
</details>
<div class="admonition todo">
<p class="admonition-title">跟踪 Issue 解决情况</p>
<p><a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/issues/7298"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></span> journald - Consider parsing more known fields from logs · Issue #7298 · open-telemetry/opentelemetry-collector-contrib</a> 从 2022 年初开始追踪这个问题，现在仍在等待 Log 的语义约定进一步明确。</p>
<p>该 Issue 解决后，就无需自定义 Operator 了。</p>
</div>
<p>目前我们用自定义 Operator 将 Body 中除 <code>MESSAGE</code> 外的字段移动到 Attributes，并识别已有明确语义的字段。在解析时需要注意并不是所有字段都在任何情况下存在。kernel 日志就没有 <code>SYSTEMD_UNIT</code>、<code>_CMDLINE</code> 等字段。</p>
<details class="example">
<summary>Example</summary>
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>{
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>    &quot;_TRANSPORT&quot;: &quot;kernel&quot;,
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>    &quot;_HOSTNAME&quot;: &quot;bowling-pc&quot;,
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>    &quot;MESSAGE&quot;: &quot;usbcore: registered new device driver apple-mfi-fastcharge&quot;,
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>    &quot;SYSLOG_IDENTIFIER&quot;: &quot;kernel&quot;,
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>    &quot;_MACHINE_ID&quot;: &quot;39242ca0196f43d9a28b324ea19f63b0&quot;,
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>    &quot;__REALTIME_TIMESTAMP&quot;: &quot;1728053826689649&quot;,
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>    &quot;_BOOT_ID&quot;: &quot;0bc0ee799eb84fc3b44aab1fca1eb25d&quot;,
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>    &quot;__CURSOR&quot;: &quot;s=57e0884c55414fdaa457d6c3a187f3e0;i=2198;b=0bc0ee799eb84fc3b44aab1fca1eb25d;m=3b05b3;t=623a7e27e1a71;x=5b4af5d3f49495e2&quot;,
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>    &quot;_SOURCE_MONOTONIC_TIMESTAMP&quot;: &quot;3867428&quot;,
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>    &quot;__SEQNUM&quot;: &quot;8600&quot;,
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>    &quot;PRIORITY&quot;: &quot;6&quot;,
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>    &quot;_RUNTIME_SCOPE&quot;: &quot;system&quot;,
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>    &quot;__SEQNUM_ID&quot;: &quot;57e0884c55414fdaa457d6c3a187f3e0&quot;,
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>    &quot;__MONOTONIC_TIMESTAMP&quot;: &quot;3868083&quot;,
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>    &quot;SYSLOG_FACILITY&quot;: &quot;0&quot;
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a>    }
</span></code></pre></div>
</details>
<details class="note">
<summary>Operator 配置</summary>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="nt">operators</span><span class="p">:</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">move</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">body</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">attributes.journal</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">move</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">attributes.journal.MESSAGE</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">body</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">move</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">attributes.journal.SYSLOG_IDENTIFIER</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">resource.service.name</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;type(attributes.journal.SYSLOG_IDENTIFIER)</span><span class="nv"> </span><span class="s">!=</span><span class="nv"> </span><span class="s">&quot;nil&quot;&#39;</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">move</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">attributes.journal._PID</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">resource.process.pid</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;type(attributes.journal._PID)</span><span class="nv"> </span><span class="s">!=</span><span class="nv"> </span><span class="s">&quot;nil&quot;&#39;</span>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">move</span>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">attributes.journal._COMM</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">resource.process.executable.name</span>
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;type(attributes.journal._COMM)</span><span class="nv"> </span><span class="s">!=</span><span class="nv"> </span><span class="s">&quot;nil&quot;&#39;</span>
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">move</span>
</span><span id="__span-18-21"><a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">attributes.journal._EXE</span>
</span><span id="__span-18-22"><a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a><span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">resource.process.executable.path</span>
</span><span id="__span-18-23"><a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;type(attributes.journal._EXE)</span><span class="nv"> </span><span class="s">!=</span><span class="nv"> </span><span class="s">&quot;nil&quot;&#39;</span>
</span><span id="__span-18-24"><a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">move</span>
</span><span id="__span-18-25"><a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">attributes.journal._CMDLINE</span>
</span><span id="__span-18-26"><a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a><span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">resource.process.command_line</span>
</span><span id="__span-18-27"><a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;type(attributes.journal._CMDLINE)</span><span class="nv"> </span><span class="s">!=</span><span class="nv"> </span><span class="s">&quot;nil&quot;&#39;</span>
</span><span id="__span-18-28"><a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">move</span>
</span><span id="__span-18-29"><a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">attributes.journal._UID</span>
</span><span id="__span-18-30"><a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a><span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">resource.process.owner</span>
</span><span id="__span-18-31"><a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;type(attributes.journal._UID)</span><span class="nv"> </span><span class="s">!=</span><span class="nv"> </span><span class="s">&quot;nil&quot;&#39;</span>
</span><span id="__span-18-32"><a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a><span class="c1"># 下面的字段所有情况都有</span>
</span><span id="__span-18-33"><a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">move</span>
</span><span id="__span-18-34"><a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">attributes.journal._HOSTNAME</span>
</span><span id="__span-18-35"><a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a><span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">resource.host.name</span>
</span><span id="__span-18-36"><a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">severity_parser</span>
</span><span id="__span-18-37"><a id="__codelineno-18-37" name="__codelineno-18-37" href="#__codelineno-18-37"></a><span class="nt">parse_from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">attributes.journal.PRIORITY</span>
</span><span id="__span-18-38"><a id="__codelineno-18-38" name="__codelineno-18-38" href="#__codelineno-18-38"></a><span class="nt">preset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
</span><span id="__span-18-39"><a id="__codelineno-18-39" name="__codelineno-18-39" href="#__codelineno-18-39"></a><span class="nt">mapping</span><span class="p">:</span>
</span><span id="__span-18-40"><a id="__codelineno-18-40" name="__codelineno-18-40" href="#__codelineno-18-40"></a><span class="c1"># OTel severity number: systemd priority # syslog severity</span>
</span><span id="__span-18-41"><a id="__codelineno-18-41" name="__codelineno-18-41" href="#__codelineno-18-41"></a><span class="w">    </span><span class="nt">fatal</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w"> </span><span class="c1"># emerg</span>
</span><span id="__span-18-42"><a id="__codelineno-18-42" name="__codelineno-18-42" href="#__codelineno-18-42"></a><span class="w">    </span><span class="nt">error3</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"> </span><span class="c1"># alert</span>
</span><span id="__span-18-43"><a id="__codelineno-18-43" name="__codelineno-18-43" href="#__codelineno-18-43"></a><span class="w">    </span><span class="nt">error2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"> </span><span class="c1"># crit</span>
</span><span id="__span-18-44"><a id="__codelineno-18-44" name="__codelineno-18-44" href="#__codelineno-18-44"></a><span class="w">    </span><span class="nt">error</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-18-45"><a id="__codelineno-18-45" name="__codelineno-18-45" href="#__codelineno-18-45"></a><span class="w">    </span><span class="nt">warn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
</span><span id="__span-18-46"><a id="__codelineno-18-46" name="__codelineno-18-46" href="#__codelineno-18-46"></a><span class="w">    </span><span class="nt">info2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span><span class="w"> </span><span class="c1"># notice</span>
</span><span id="__span-18-47"><a id="__codelineno-18-47" name="__codelineno-18-47" href="#__codelineno-18-47"></a><span class="w">    </span><span class="nt">info</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6</span>
</span><span id="__span-18-48"><a id="__codelineno-18-48" name="__codelineno-18-48" href="#__codelineno-18-48"></a><span class="w">    </span><span class="nt">debug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7</span>
</span></code></pre></div>
</details>
<h3 id="应用日志适配">应用日志适配<a class="headerlink" href="#应用日志适配" title="Permanent link">&para;</a></h3>
<h4 id="sssd">sssd<a class="headerlink" href="#sssd" title="Permanent link">&para;</a></h4>
<p>sssd 是典型的把日志放在 <code>/var/log</code> 目录下的服务，而且不会自己创文件夹。无盘系统下挂载 <code>/var/log</code> 到 tmpfs 后，sssd 每次启动都会报错，而且还是广播，非常烦人：</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>Broadcast message from systemd-journald@ZJUSCT-HPC101-LOGIN (Fri 2024-08-09 22:32:29 CST):
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>sssd[18443]: Could not open file [/var/log/sssd/sssd.log]. Error: [2][No such file or directory]
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>Broadcast message from systemd-journald@ZJUSCT-HPC101-LOGIN (Fri 2024-08-09 22:32:29 CST):
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>sssd_nss[18452]: Could not open file [/var/log/sssd/sssd_nss.log]. Error: [2][No such file or directory]
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>Broadcast message from systemd-journald@ZJUSCT-HPC101-LOGIN (Fri 2024-08-09 22:32:29 CST):
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>sssd_pam[18460]: Could not open file [/var/log/sssd/sssd_pam.log]. Error: [2][No such file or directory]
</span></code></pre></div>
<p>根据 <a href="https://github.com/SSSD/sssd/issues/7078"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></span> Hardcoded DEBUG_LOGGER=--logger=files is sssd service scripts #7078</a> 的解释，重要的日志始终是通过 <code>sd_journal_send()</code> 或 <code>vsyslog()</code> 发送的，存储到文件中的是普通信息，这是为了减轻对 journal 的压力（在大集群中比较重要）。</p>
<p>一个解决办法是修改出现问题的三个服务，添加下面配置：</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>systemctl<span class="w"> </span>edit<span class="w"> </span>sssd
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>systemctl<span class="w"> </span>edit<span class="w"> </span>sssd_nss
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>systemctl<span class="w"> </span>edit<span class="w"> </span>sssd_pam
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>[Service]
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>Environment=DEBUG_LOGGER=--logger=journald
</span></code></pre></div>
<p>这样调试信息也会发送到 journal，不会因为本地日志文件不存在而报错，利于统一收集日志信息。</p>
<h4 id="munge">munge<a class="headerlink" href="#munge" title="Permanent link">&para;</a></h4>
<p>munge 也是这样的程序，会将自己的日志写入 <code>/var/log/munge/munged.log</code>，并且对文件权限极其敏感。<a href="https://github.com/openhpc/ohpc/issues/943"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></span> Make munge log to syslog · Issue #943 · openhpc/ohpc</a> 解决了这一问题。可以看到，很多 HPC 集群都选择将日志发送到统一的服务器：</p>
<blockquote>
<p>By default munge writes logs by itself to /var/long/munge/munged.log. This prevents those logs from being forwarded to the log server (e.g. the OpenHPC SMS/admin machine), and in case those logs for one reason or another grows rapidly (e.g. dun/munge#26 ) it can be a problem for diskless nodes (or compute nodes with small partitions where /var/log reside).</p>
</blockquote>
<p>修改 munge 配置文件添加启动参数 <code>--syslog</code> 即可。</p>
<h4 id="exim4">exim4<a class="headerlink" href="#exim4" title="Permanent link">&para;</a></h4>
<p>exim4 是一个邮件服务器，它的日志默认写入 <code>/var/log/exim4/mainlog</code>，无法写入日志将导致服务失败。可以通过修改 <code>/etc/exim4/exim4.conf</code> 文件中的 <code>log_file_path</code> 参数来更改日志文件路径。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>log_file_path = syslog
</span></code></pre></div>
<h4 id="nginx">Nginx<a class="headerlink" href="#nginx" title="Permanent link">&para;</a></h4>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<ul>
<li><a href="https://lanjingling.github.io/2016/03/14/nginx-access-log/">nginx access_log 日志 - 晓的技术博客</a></li>
<li><a href="https://docs.nginx.com/nginx/admin-guide/monitoring/logging/">Configuring Logging - NGINX Documentation</a></li>
<li><a href="http://nginx.org/en/docs/http/ngx_http_log_module.html">Module ngx_http_log_module</a></li>
</ul>
</div>
<p>Nginx 日志分为访问日志和错误日志。</p>
<p>访问日志可通过 <code>log_format</code> 命令自定义格式，我们将其定义为下面的 JSON 格式，以便 OpenTelemetry Collector 解析。</p>
<details class="note">
<summary>Nginx 访问日志配置</summary>
<div class="language-text highlight"><span class="filename">/etc/nginx/nginx.conf</span><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a># http://nginx.org/en/docs/varindex.html
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>log_format otel_json escape=json &#39;{&#39;
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a># https://opentelemetry.io/docs/specs/semconv/attributes-registry/http/
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>&#39;&quot;http&quot;: {&#39;
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>    &#39;&quot;request&quot;: {&#39;
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>    &#39;&quot;header&quot;: {&#39;
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>        &#39;&quot;x-forwarded-for&quot;: &quot;$http_x_forwarded_for&quot;, &#39;
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>        &#39;&quot;user-agent&quot;: &quot;$http_user_agent&quot;, &#39;
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>        &#39;&quot;host&quot;: &quot;$http_host&quot;, &#39;
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>        &#39;&quot;referer&quot;: &quot;$http_referer&quot;, &#39;
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>        &#39;&quot;content-length&quot;: &quot;$content_length&quot;, &#39;
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>        &#39;&quot;content-type&quot;: &quot;$content_type&quot;&#39;
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>    &#39;}, &#39;
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>    &#39;&quot;method&quot;: &quot;$request_method&quot;, &#39;
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>    &#39;&quot;size&quot;: &quot;$request_length&quot;&#39;
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a>    &#39;}, &#39;
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>    &#39;&quot;response&quot;: {&#39;
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a>    &#39;&quot;body&quot;: {&#39;
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a>        &#39;&quot;size&quot;: &quot;$bytes_sent&quot;&#39;
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a>    &#39;}, &#39;
</span><span id="__span-23-21"><a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a>    &#39;&quot;status_code&quot;: &quot;$status&quot;&#39;
</span><span id="__span-23-22"><a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a>    &#39;}&#39;
</span><span id="__span-23-23"><a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a>&#39;}, &#39;
</span><span id="__span-23-24"><a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a># https://opentelemetry.io/docs/specs/semconv/attributes-registry/url/
</span><span id="__span-23-25"><a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a>&#39;&quot;url&quot;: {&#39;
</span><span id="__span-23-26"><a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a>    &#39;&quot;domain&quot;: &quot;$host&quot;, &#39;
</span><span id="__span-23-27"><a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a>    #&#39;&quot;original&quot;: &quot;$scheme://$host$request_uri&quot;, &#39;
</span><span id="__span-23-28"><a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a>    &#39;&quot;scheme&quot;: &quot;$scheme&quot;, &#39;
</span><span id="__span-23-29"><a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a>    &#39;&quot;path&quot;: &quot;$uri&quot;, &#39;
</span><span id="__span-23-30"><a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a>    &#39;&quot;query&quot;: &quot;$args&quot;&#39;
</span><span id="__span-23-31"><a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a>&#39;}, &#39;
</span><span id="__span-23-32"><a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a># https://opentelemetry.io/docs/specs/semconv/attributes-registry/client/
</span><span id="__span-23-33"><a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a>&#39;&quot;client&quot;: {&#39;
</span><span id="__span-23-34"><a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a>    &#39;&quot;address&quot;: &quot;$remote_addr&quot;, &#39;
</span><span id="__span-23-35"><a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a>    &#39;&quot;port&quot;: &quot;$remote_port&quot;&#39;
</span><span id="__span-23-36"><a id="__codelineno-23-36" name="__codelineno-23-36" href="#__codelineno-23-36"></a>&#39;}, &#39;
</span><span id="__span-23-37"><a id="__codelineno-23-37" name="__codelineno-23-37" href="#__codelineno-23-37"></a># https://opentelemetry.io/docs/specs/semconv/attributes-registry/server/
</span><span id="__span-23-38"><a id="__codelineno-23-38" name="__codelineno-23-38" href="#__codelineno-23-38"></a>&#39;&quot;server&quot;: {&#39;
</span><span id="__span-23-39"><a id="__codelineno-23-39" name="__codelineno-23-39" href="#__codelineno-23-39"></a>    &#39;&quot;address&quot;: &quot;$server_addr&quot;, &#39;
</span><span id="__span-23-40"><a id="__codelineno-23-40" name="__codelineno-23-40" href="#__codelineno-23-40"></a>    &#39;&quot;port&quot;: &quot;$server_port&quot;&#39;
</span><span id="__span-23-41"><a id="__codelineno-23-41" name="__codelineno-23-41" href="#__codelineno-23-41"></a>&#39;}, &#39;
</span><span id="__span-23-42"><a id="__codelineno-23-42" name="__codelineno-23-42" href="#__codelineno-23-42"></a># https://opentelemetry.io/docs/specs/semconv/attributes-registry/process/
</span><span id="__span-23-43"><a id="__codelineno-23-43" name="__codelineno-23-43" href="#__codelineno-23-43"></a>&#39;&quot;resource&quot;: {&#39;
</span><span id="__span-23-44"><a id="__codelineno-23-44" name="__codelineno-23-44" href="#__codelineno-23-44"></a>    &#39;&quot;process&quot;: {&#39;
</span><span id="__span-23-45"><a id="__codelineno-23-45" name="__codelineno-23-45" href="#__codelineno-23-45"></a>    &#39;&quot;pid&quot;: &quot;$pid&quot;&#39;
</span><span id="__span-23-46"><a id="__codelineno-23-46" name="__codelineno-23-46" href="#__codelineno-23-46"></a>    &#39;}&#39;
</span><span id="__span-23-47"><a id="__codelineno-23-47" name="__codelineno-23-47" href="#__codelineno-23-47"></a>&#39;}, &#39;
</span><span id="__span-23-48"><a id="__codelineno-23-48" name="__codelineno-23-48" href="#__codelineno-23-48"></a># other attributes
</span><span id="__span-23-49"><a id="__codelineno-23-49" name="__codelineno-23-49" href="#__codelineno-23-49"></a>&#39;&quot;timestamp&quot;: &quot;$msec&quot;, &#39;
</span><span id="__span-23-50"><a id="__codelineno-23-50" name="__codelineno-23-50" href="#__codelineno-23-50"></a>&#39;&quot;body&quot;: &quot;$request&quot;, &#39;
</span><span id="__span-23-51"><a id="__codelineno-23-51" name="__codelineno-23-51" href="#__codelineno-23-51"></a>&#39;&quot;nginx&quot;: {&#39;
</span><span id="__span-23-52"><a id="__codelineno-23-52" name="__codelineno-23-52" href="#__codelineno-23-52"></a>    &#39;&quot;connection_requests&quot;: &quot;$connection_requests&quot;, &#39;
</span><span id="__span-23-53"><a id="__codelineno-23-53" name="__codelineno-23-53" href="#__codelineno-23-53"></a>    &#39;&quot;request_id&quot;: &quot;$request_id&quot;, &#39;
</span><span id="__span-23-54"><a id="__codelineno-23-54" name="__codelineno-23-54" href="#__codelineno-23-54"></a>    &#39;&quot;request_time&quot;: &quot;$request_time&quot;, &#39;
</span><span id="__span-23-55"><a id="__codelineno-23-55" name="__codelineno-23-55" href="#__codelineno-23-55"></a>    &#39;&quot;upstream&quot;: &quot;$upstream_addr&quot;, &#39;
</span><span id="__span-23-56"><a id="__codelineno-23-56" name="__codelineno-23-56" href="#__codelineno-23-56"></a>    &#39;&quot;upstream_connect_time&quot;: &quot;$upstream_connect_time&quot;, &#39;
</span><span id="__span-23-57"><a id="__codelineno-23-57" name="__codelineno-23-57" href="#__codelineno-23-57"></a>    &#39;&quot;upstream_header_time&quot;: &quot;$upstream_header_time&quot;, &#39;
</span><span id="__span-23-58"><a id="__codelineno-23-58" name="__codelineno-23-58" href="#__codelineno-23-58"></a>    &#39;&quot;upstream_response_time&quot;: &quot;$upstream_response_time&quot;, &#39;
</span><span id="__span-23-59"><a id="__codelineno-23-59" name="__codelineno-23-59" href="#__codelineno-23-59"></a>    &#39;&quot;upstream_response_length&quot;: &quot;$upstream_response_length&quot;, &#39;
</span><span id="__span-23-60"><a id="__codelineno-23-60" name="__codelineno-23-60" href="#__codelineno-23-60"></a>    &#39;&quot;upstream_cache_status&quot;: &quot;$upstream_cache_status&quot;, &#39;
</span><span id="__span-23-61"><a id="__codelineno-23-61" name="__codelineno-23-61" href="#__codelineno-23-61"></a>    &#39;&quot;ssl_protocol&quot;: &quot;$ssl_protocol&quot;, &#39;
</span><span id="__span-23-62"><a id="__codelineno-23-62" name="__codelineno-23-62" href="#__codelineno-23-62"></a>    &#39;&quot;ssl_cipher&quot;: &quot;$ssl_cipher&quot;, &#39;
</span><span id="__span-23-63"><a id="__codelineno-23-63" name="__codelineno-23-63" href="#__codelineno-23-63"></a>    #&#39;&quot;server_protocol&quot;: &quot;$server_protocol&quot;, &#39;
</span><span id="__span-23-64"><a id="__codelineno-23-64" name="__codelineno-23-64" href="#__codelineno-23-64"></a>    &#39;&quot;pipe&quot;: &quot;$pipe&quot;, &#39;
</span><span id="__span-23-65"><a id="__codelineno-23-65" name="__codelineno-23-65" href="#__codelineno-23-65"></a>    &#39;&quot;bad_req&quot;: &quot;$bad_req&quot;, &#39;
</span><span id="__span-23-66"><a id="__codelineno-23-66" name="__codelineno-23-66" href="#__codelineno-23-66"></a>    &#39;&quot;bad_ip&quot;: &quot;$badip_ip&quot;, &#39;
</span><span id="__span-23-67"><a id="__codelineno-23-67" name="__codelineno-23-67" href="#__codelineno-23-67"></a>    #&#39;&quot;geoip_country_code&quot;: &quot;$geoip_country_code&quot;&#39;
</span><span id="__span-23-68"><a id="__codelineno-23-68" name="__codelineno-23-68" href="#__codelineno-23-68"></a>&#39;}&#39;
</span><span id="__span-23-69"><a id="__codelineno-23-69" name="__codelineno-23-69" href="#__codelineno-23-69"></a>&#39;}&#39;;
</span></code></pre></div>
</details>
<p>错误日志格式并不清晰，<a href="https://stackoverflow.com/questions/16711573/nginx-error-log-format-documentation">logging - NGINX error log format documentation - Stack Overflow</a> 作了一些解释。我们使用下面的正则表达式来解析错误日志：</p>
<details class="note">
<summary>Nginx 错误日志解析</summary>
<div class="language-text highlight"><span class="filename">otelcol.yaml</span><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>operators:
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>    - type: regex_parser
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>    regex: &#39;(?P&lt;timestamp&gt;\d{4}/\d{2}/\d{2} \d{2}:\d{2}:\d{2}) \[(?P&lt;severity&gt;\w+)\] (?P&lt;pid&gt;\d+)#(?P&lt;tid&gt;\d+): (?:\*(?P&lt;cid&gt;\d+) )?(?P&lt;message&gt;[^,]+)(?:, (?P&lt;kv&gt;.+))?&#39;
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>    timestamp:
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>        layout: &quot;%Y/%m/%d %H:%M:%S&quot;
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>        parse_from: attributes[&quot;timestamp&quot;]
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>    severity:
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>        parse_from: attributes[&quot;severity&quot;]
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>        # nginx error level: debug, info, notice, warn, error, crit, alert, or emerg
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>        overwrite_text: true
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>        mapping:
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>        FATAL: emerg
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>        ERROR3: alert
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>        ERROR2: crit
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a>        ERROR: error
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a>        WARN: warn
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a>        INFO2: notice
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>        INFO: info
</span><span id="__span-24-19"><a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a>        DEBUG: debug
</span><span id="__span-24-20"><a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a>    - type: remove
</span><span id="__span-24-21"><a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a>    field: attributes[&quot;timestamp&quot;]
</span><span id="__span-24-22"><a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a>    - type: remove
</span><span id="__span-24-23"><a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a>    field: attributes[&quot;severity&quot;]
</span><span id="__span-24-24"><a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a>    - type: move
</span><span id="__span-24-25"><a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a>    from: attributes[&quot;message&quot;]
</span><span id="__span-24-26"><a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a>    to: body
</span><span id="__span-24-27"><a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a>    - type: move
</span><span id="__span-24-28"><a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a>    from: attributes[&quot;pid&quot;]
</span><span id="__span-24-29"><a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a>    to: resource[&quot;process.pid&quot;]
</span><span id="__span-24-30"><a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a>    - type: move
</span><span id="__span-24-31"><a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a>    from: attributes[&quot;tid&quot;]
</span><span id="__span-24-32"><a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a>    to: resource[&quot;thread.id&quot;]
</span><span id="__span-24-33"><a id="__codelineno-24-33" name="__codelineno-24-33" href="#__codelineno-24-33"></a>    - type: move
</span><span id="__span-24-34"><a id="__codelineno-24-34" name="__codelineno-24-34" href="#__codelineno-24-34"></a>    from: attributes[&quot;cid&quot;]
</span><span id="__span-24-35"><a id="__codelineno-24-35" name="__codelineno-24-35" href="#__codelineno-24-35"></a>    to: resource[&quot;correlation.id&quot;]
</span><span id="__span-24-36"><a id="__codelineno-24-36" name="__codelineno-24-36" href="#__codelineno-24-36"></a>    if: &#39;type(attributes[&quot;cid&quot;]) != &quot;nil&quot;&#39;
</span><span id="__span-24-37"><a id="__codelineno-24-37" name="__codelineno-24-37" href="#__codelineno-24-37"></a>    # kv
</span><span id="__span-24-38"><a id="__codelineno-24-38" name="__codelineno-24-38" href="#__codelineno-24-38"></a>    - type: key_value_parser
</span><span id="__span-24-39"><a id="__codelineno-24-39" name="__codelineno-24-39" href="#__codelineno-24-39"></a>    parse_from: attributes[&quot;kv&quot;]
</span><span id="__span-24-40"><a id="__codelineno-24-40" name="__codelineno-24-40" href="#__codelineno-24-40"></a>    parse_to: attributes[&quot;nginx&quot;]
</span><span id="__span-24-41"><a id="__codelineno-24-41" name="__codelineno-24-41" href="#__codelineno-24-41"></a>    delimiter: &#39;:&#39;
</span><span id="__span-24-42"><a id="__codelineno-24-42" name="__codelineno-24-42" href="#__codelineno-24-42"></a>    pair_delimiter: &#39;,&#39;
</span><span id="__span-24-43"><a id="__codelineno-24-43" name="__codelineno-24-43" href="#__codelineno-24-43"></a>    # kv is always a string even if it is empty, so do not use
</span><span id="__span-24-44"><a id="__codelineno-24-44" name="__codelineno-24-44" href="#__codelineno-24-44"></a>    # type(attributes[&quot;kv&quot;]) != &quot;nil&quot;
</span><span id="__span-24-45"><a id="__codelineno-24-45" name="__codelineno-24-45" href="#__codelineno-24-45"></a>    if: &#39;attributes[&quot;kv&quot;] != &quot;&quot;&#39;
</span><span id="__span-24-46"><a id="__codelineno-24-46" name="__codelineno-24-46" href="#__codelineno-24-46"></a>    - type: remove
</span><span id="__span-24-47"><a id="__codelineno-24-47" name="__codelineno-24-47" href="#__codelineno-24-47"></a>    field: attributes[&quot;kv&quot;]
</span></code></pre></div>
</details>
<details class="example">
<summary>Nginx 错误日志样例</summary>
<div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>2024/10/06 00:16:21 [error] 1285318#1285318: *3020238683 limiting requests, excess: 0.356 by zone &quot;badreqlimit&quot;, client: 221.11.39.67, server: mirror.zju.edu.cn, request: &quot;GET /debian-cd/11.6.0/s390x/iso-dvd/debian-11.6.0-s390x-DVD-1.iso HTTP/1.1&quot;, host: &quot;mirrors.zju.edu.cn&quot;
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>2024/10/06 00:42:49 [error] 1285316#1285316: *3020285623 open() &quot;/data/storage/direct/favicon.ico&quot; failed (2: No such file or directory), client: 45.251.240.168, server: mirror.zju.edu.cn, request: &quot;GET /favicon.ico HTTP/1.0&quot;, host: &quot;mirrors.zju.edu.cn&quot;
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>2024/10/06 00:42:02 [warn] 1285318#1285318: *3020284230 upstream server temporarily disabled while connecting to upstream, client: 2001:250:4:100::2, server: mirror.zju.edu.cn, request: &quot;GET /api/mirrorz.json HTTP/1.1&quot;, upstream: &quot;http://[::1]:6003/mirrorz.json&quot;, host: &quot;mirrors.zju.edu.cn&quot;
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>2024/10/06 00:42:02 [error] 1285318#1285318: *3020284230 connect() failed (111: Connection refused) while connecting to upstream, client: 2001:250:4:100::2, server: mirror.zju.edu.cn, request: &quot;GET /api/mirrorz.json HTTP/1.1&quot;, upstream: &quot;http://[::1]:6003/mirrorz.json&quot;, host: &quot;mirrors.zju.edu.cn&quot;
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>2024/10/06 00:29:03 [alert] 1285318#1285318: *3020261617 could not allocate new session in SSL session shared cache &quot;MozSSL&quot; while SSL handshaking, client: 2409:8934:9e08:62d3::1, server: [::]:443
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>2024/10/06 00:07:16 [crit] 1285318#1285318: *3020215598 SSL_do_handshake() failed (SSL: error:141CF06C:SSL routines:tls_parse_ctos_key_share:bad key share) while SSL handshaking, client: 49.7.224.233, server: 0.0.0.0:443
</span></code></pre></div>
</details>
<h4 id="docker">Docker<a class="headerlink" href="#docker" title="Permanent link">&para;</a></h4>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<ul>
<li><a href="https://opentelemetry.io/blog/2024/otel-collector-container-log-parser/">Introducing the new container log parser for OpenTelemetry Collector - OpenTelemetry</a></li>
<li><a href="https://docs.docker.com/engine/logging/drivers/json-file/">JSON File logging driver - Docker Docs</a></li>
</ul>
</div>
<p>Docker 容器可以指定 Log Driver，默认为 <code>json-file</code>，存储于 <code>/var/lib/docker/containers/&lt;container-id&gt;/&lt;container-id&gt;-json.log</code>。默认情况下每行内容仅有 <code>log</code>、<code>stream</code>、<code>time</code> 三个字段，可以通过配置 <code>log-opts</code> 来添加额外字段。需要添加的额外字段考虑和 <code>dockerstatsreceiver</code> 的默认启用字段对齐，以便将 Log 和 Metric 关联起来。</p>
<ul>
<li><code>container.hostname</code></li>
<li><code>container.id</code></li>
<li><code>container.image.name</code></li>
<li><code>container.name</code></li>
<li><code>container.runtime</code></li>
</ul>
<div class="language-json highlight"><span class="filename">/etc/docker/daemon.json</span><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="p">{</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">  </span><span class="nt">&quot;log-opts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">    </span><span class="nt">&quot;tag&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;container.name={{.Name}} container.id={{.ID}} container.image.name={{.ImageName}} container.runtime={{.DaemonName}}&quot;</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="p">}</span>
</span></code></pre></div>
<div class="admonition warning">
<p class="admonition-title">注意修改 <code>daemon.json</code> 后，<code>log-opts</code> 仅对新创建的容器生效，已经创建的容器需要重建。</p>
</div>
<p>修改后的日志格式如下：</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="p">{</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="w">  </span><span class="nt">&quot;log&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;[2024-10-14 12:58:52.07328] [33867] [info] Worker 33867 started\n&quot;</span><span class="p">,</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="w">  </span><span class="nt">&quot;stream&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;stderr&quot;</span><span class="p">,</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w">  </span><span class="nt">&quot;attrs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="w">    </span><span class="nt">&quot;tag&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;container.name=lanraragi container.id=3a6d0edc99f29a114a93dfe31a71cb4322cbb7a9b4dd9655dc8aecef2b8248e4 container.image.name=docker.io/difegue/lanraragi container.runtime=docker&quot;</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="w">  </span><span class="nt">&quot;time&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2024-10-14T12:58:52.073349989Z&quot;</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="p">}</span>
</span></code></pre></div>
<p>使用 <code>filelogreceiver</code> 搭配 <code>container</code> operator 可以完成容器日志的收集。</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="nt">filelog/docker</span><span class="p">:</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">  </span><span class="nt">include</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/docker/containers/*/*-json.log</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">  </span><span class="nt">start_at</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">beginning</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="w">  </span><span class="nt">operators</span><span class="p">:</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">container</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="w">      </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="w">      </span><span class="nt">add_metadata_from_filepath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">key_value_parser</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="w">      </span><span class="nt">parse_from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">attributes.attrs.tag</span>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="w">      </span><span class="nt">parse_to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">resource</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="w">      </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;type(attributes.attrs)</span><span class="nv"> </span><span class="s">!=</span><span class="nv"> </span><span class="s">&quot;nil&quot;&#39;</span>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">remove</span>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="w">      </span><span class="nt">field</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">attributes.attrs</span>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="w">      </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;type(attributes.attrs)</span><span class="nv"> </span><span class="s">!=</span><span class="nv"> </span><span class="s">&quot;nil&quot;&#39;</span>
</span></code></pre></div>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="April 25, 2025 09:15:53">April 25, 2025</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Created">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="April 25, 2025 09:15:53">April 25, 2025</span>
  </span>

    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../" class="md-footer__link md-footer__link--prev" aria-label="Previous: 可观测性">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                可观测性
              </div>
            </div>
          </a>
        
        
          
          <a href="../network/" class="md-footer__link md-footer__link--next" aria-label="Next: 网络观测">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                网络观测
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      ZJUSCT
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy", "content.code.select", "content.code.annotate", "navigation.footer", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.tracking", "navigation.path", "navigation.top", "toc.follow", "content.action.edit", "search.suggest", "search.highlight", "search.share"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/polyfill/index.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/tablesort/dist/tablesort.min.js"></script>
      
        <script src="../../../javascripts/tablesort.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>